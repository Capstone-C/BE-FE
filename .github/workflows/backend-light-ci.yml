name: ğŸª¶ Backend Light CI

# ê°€ë²¼ìš´ CI: PR ì´ˆê¸° ë‹¨ê³„ì—ì„œ ë¹ ë¥¸ í”¼ë“œë°±ìš© (ëª©í‘œ: 30-60ì´ˆ)
on:
  pull_request:
    branches: [ develop, 'feat/**', 'fix/**' ]
    paths:
      - 'CC_BE/**'
      - '.github/workflows/backend-light-ci.yml'

# ë™ì‹œ ì‹¤í–‰ ì œì–´ (ìµœì‹  ê²ƒë§Œ ì‹¤í–‰)
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  light-check:
    name: âš¡ Quick Compile Check
    runs-on: ubuntu-latest
    timeout-minutes: 3  # 3ë¶„ ì´ìƒ ê±¸ë¦¬ë©´ ì·¨ì†Œ
    
    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ (ìµœì†Œ íˆìŠ¤í† ë¦¬)
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      
      # 2. JDK 17 ì„¤ì • (ìºì‹± ìµœëŒ€ í™œìš©)
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'
      
      # 3. Gradle ì˜ì¡´ì„± ìºì‹±
      - name: Cache Gradle
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-
      
      # 4. Gradle ì‹¤í–‰ ê¶Œí•œ
      - name: Grant execute permission
        working-directory: ./CC_BE
        run: chmod +x gradlew
      
      # 5. ì´ˆê³ ì† ì»´íŒŒì¼ ì²´í¬ (í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ, JAR ë¹Œë“œ ìŠ¤í‚µ)
      - name: ğŸš€ Lightning Fast Compile
        working-directory: ./CC_BE
        run: |
          ./gradlew compileJava compileTestJava \
            --no-daemon \
            --parallel \
            --build-cache \
            --console=plain \
            -x test \
            -x bootJar \
            -x jar
        env:
          GRADLE_OPTS: "-Xmx1g -XX:MaxMetaspaceSize=256m -XX:+UseParallelGC"
      
      # 6. ì»´íŒŒì¼ ì„±ê³µ ë©”ì‹œì§€
      - name: âœ… Compile Success
        if: success()
        run: echo "âœ… ì»´íŒŒì¼ ì„±ê³µ! ì½”ë“œì— ë¬¸ë²• ì˜¤ë¥˜ê°€ ì—†ìŠµë‹ˆë‹¤."
