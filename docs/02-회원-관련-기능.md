# íšŒì› ê´€ë ¨ ê¸°ëŠ¥ (Issue #11)

> **GitHub Issue**: https://github.com/Capstone-C/BE-FE/issues/11  
> **ë‹´ë‹¹ì**: qoweh  
> **PR**: #112 (Merged)

---

## ğŸ“‹ ëª©ì°¨
1. [ê¸°ëŠ¥ ê°œìš”](#1-ê¸°ëŠ¥-ê°œìš”)
2. [ì„œë¸Œ ì´ìŠˆ ëª©ë¡](#2-ì„œë¸Œ-ì´ìŠˆ-ëª©ë¡)
3. [íŒŒì¼ êµ¬ì¡°](#3-íŒŒì¼-êµ¬ì¡°)
4. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](#4-ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ)
5. [API ëª…ì„¸](#5-api-ëª…ì„¸)
6. [í•µì‹¬ êµ¬í˜„ ìƒì„¸](#6-í•µì‹¬-êµ¬í˜„-ìƒì„¸)
7. [ë³´ì•ˆ ê¸°ëŠ¥](#7-ë³´ì•ˆ-ê¸°ëŠ¥)
8. [ë””ìì¸ íŒ¨í„´](#8-ë””ìì¸-íŒ¨í„´)
9. [ì˜ˆìƒ ì§ˆë¬¸ ë° ë‹µë³€](#9-ì˜ˆìƒ-ì§ˆë¬¸-ë°-ë‹µë³€)

---

## 1. ê¸°ëŠ¥ ê°œìš”

íšŒì› ê´€ë¦¬ ì‹œìŠ¤í…œì€ ì‚¬ìš©ì ì¸ì¦ ë° í”„ë¡œí•„ ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ ëª¨ë“ˆì…ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥
- íšŒì›ê°€ì…/ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
- í”„ë¡œí•„ ì¡°íšŒ/ìˆ˜ì •
- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½/ì°¾ê¸°
- íšŒì› íƒˆí‡´ (Soft Delete)
- ì‚¬ìš©ì ì°¨ë‹¨/ì°¨ë‹¨ í•´ì œ

---

## 2. ì„œë¸Œ ì´ìŠˆ ëª©ë¡

| ì´ìŠˆ | ì œëª© | ìƒíƒœ |
|------|------|------|
| #12 | MEM-01: íšŒì›ê°€ì… | âœ… ì™„ë£Œ |
| #15 | MEM-02: ë¡œê·¸ì¸ | âœ… ì™„ë£Œ |
| #16 | MEM-03: ë¡œê·¸ì•„ì›ƒ | âœ… ì™„ë£Œ |
| #17 | MEM-04: íšŒì›ì •ë³´ ì¡°íšŒ | âœ… ì™„ë£Œ |
| #18 | MEM-05: íšŒì›ì •ë³´ ìˆ˜ì • | âœ… ì™„ë£Œ |
| #19 | MEM-07: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ | âœ… ì™„ë£Œ |
| #20 | MEM-06: íšŒì› íƒˆí‡´ | âœ… ì™„ë£Œ |
| #21 | MEM-08: ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° | âœ… ì™„ë£Œ |
| #22 | MEM-09: ì‚¬ìš©ì ì°¨ë‹¨ | âœ… ì™„ë£Œ |

---

## 3. íŒŒì¼ êµ¬ì¡°

```
/CC_BE/src/main/java/com/capstone/web/
â”œâ”€â”€ member/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ MemberController.java          # íšŒì›ê°€ì…, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
â”‚   â”‚   â”œâ”€â”€ MemberBlockController.java     # ì°¨ë‹¨/ì°¨ë‹¨í•´ì œ
â”‚   â”‚   â”œâ”€â”€ MemberProfileController.java   # í”„ë¡œí•„ ì¡°íšŒ/ìˆ˜ì •/íƒˆí‡´
â”‚   â”‚   â””â”€â”€ PasswordResetController.java   # ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ Member.java                    # íšŒì› ì—”í‹°í‹°
â”‚   â”‚   â”œâ”€â”€ MemberRole.java                # ì—­í•  Enum
â”‚   â”‚   â”œâ”€â”€ MemberBlock.java               # ì°¨ë‹¨ ê´€ê³„ ì—”í‹°í‹°
â”‚   â”‚   â”œâ”€â”€ MemberPasswordHistory.java     # ë¹„ë°€ë²ˆí˜¸ ì´ë ¥
â”‚   â”‚   â””â”€â”€ PasswordResetToken.java        # ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í† í°
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ CreateMemberRequest.java       # íšŒì›ê°€ì… ìš”ì²­
â”‚   â”‚   â”œâ”€â”€ ChangePasswordRequest.java     # ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ìš”ì²­
â”‚   â”‚   â”œâ”€â”€ UpdateMemberRequest.java       # í”„ë¡œí•„ ìˆ˜ì • ìš”ì²­
â”‚   â”‚   â””â”€â”€ MemberResponse.java            # íšŒì› ì •ë³´ ì‘ë‹µ
â”‚   â”œâ”€â”€ exception/
â”‚   â”‚   â”œâ”€â”€ MemberErrorCode.java           # ì—ëŸ¬ ì½”ë“œ Enum
â”‚   â”‚   â”œâ”€â”€ DuplicateEmailException.java
â”‚   â”‚   â”œâ”€â”€ MemberNotFoundException.java
â”‚   â”‚   â””â”€â”€ ... (ê¸°íƒ€ ì˜ˆì™¸)
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ MemberRepository.java
â”‚   â”‚   â”œâ”€â”€ MemberBlockRepository.java
â”‚   â”‚   â”œâ”€â”€ MemberPasswordHistoryRepository.java
â”‚   â”‚   â””â”€â”€ PasswordResetTokenRepository.java
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ MemberService.java             # íšŒì›ê°€ì…, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
â”‚   â”‚   â”œâ”€â”€ MemberBlockService.java        # ì°¨ë‹¨ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ MemberProfileService.java      # í”„ë¡œí•„ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ PasswordResetService.java      # ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
â”‚   â”‚   â””â”€â”€ ProfileImageService.java       # ì´ë¯¸ì§€ ì—…ë¡œë“œ
â”‚   â””â”€â”€ validation/
â”‚       â”œâ”€â”€ Password.java                  # ë¹„ë°€ë²ˆí˜¸ ì •ì±… ì–´ë…¸í…Œì´ì…˜
â”‚       â”œâ”€â”€ PasswordValidator.java
â”‚       â”œâ”€â”€ PasswordMatch.java             # ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì–´ë…¸í…Œì´ì…˜
â”‚       â””â”€â”€ PasswordMatchValidator.java
â””â”€â”€ auth/
    â”œâ”€â”€ controller/
    â”‚   â””â”€â”€ AuthController.java            # ë¡œê·¸ì¸
    â”œâ”€â”€ service/
    â”‚   â””â”€â”€ AuthService.java
    â”œâ”€â”€ jwt/
    â”‚   â”œâ”€â”€ JwtTokenProvider.java          # JWT ìƒì„±/ê²€ì¦
    â”‚   â”œâ”€â”€ JwtAuthenticationFilter.java   # ì¸ì¦ í•„í„°
    â”‚   â””â”€â”€ JwtConfig.java
    â””â”€â”€ logout/
        â”œâ”€â”€ LogoutController.java          # ë¡œê·¸ì•„ì›ƒ
        â”œâ”€â”€ LogoutService.java
        â””â”€â”€ TokenBlacklistService.java     # í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸
```

---

## 4. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 4.1 members í…Œì´ë¸”
```sql
CREATE TABLE members (
    id                      BIGINT AUTO_INCREMENT PRIMARY KEY,
    email                   VARCHAR(255) NOT NULL UNIQUE,
    password                VARCHAR(255) NOT NULL,  -- BCrypt í•´ì‹œ
    nickname                VARCHAR(50) NOT NULL UNIQUE,
    profile                 VARCHAR(255),           -- í”„ë¡œí•„ ì´ë¯¸ì§€ URL
    role                    VARCHAR(20) NOT NULL,   -- USER, ADMIN ë“±
    joined_at               DATETIME NOT NULL,
    updated_at              DATETIME,
    last_login_at           DATETIME,
    export_score            BIGINT DEFAULT 0,
    representative_badge_id BIGINT,
    deleted_at              DATETIME                -- Soft Delete
);
```

### 4.2 member_block í…Œì´ë¸”
```sql
CREATE TABLE member_block (
    id         BIGINT AUTO_INCREMENT PRIMARY KEY,
    blocker_id BIGINT NOT NULL,
    blocked_id BIGINT NOT NULL,
    created_at DATETIME NOT NULL,
    UNIQUE KEY uk_member_block (blocker_id, blocked_id),
    FOREIGN KEY (blocker_id) REFERENCES members(id),
    FOREIGN KEY (blocked_id) REFERENCES members(id)
);
```

### 4.3 member_password_history í…Œì´ë¸”
```sql
CREATE TABLE member_password_history (
    id         BIGINT AUTO_INCREMENT PRIMARY KEY,
    member_id  BIGINT NOT NULL,
    password   VARCHAR(255) NOT NULL,  -- BCrypt í•´ì‹œ
    changed_at DATETIME NOT NULL,
    FOREIGN KEY (member_id) REFERENCES members(id)
);
```

### 4.4 password_reset_token í…Œì´ë¸”
```sql
CREATE TABLE password_reset_token (
    id             BIGINT AUTO_INCREMENT PRIMARY KEY,
    member_id      BIGINT NOT NULL,
    token          VARCHAR(128) NOT NULL UNIQUE,
    expires_at     DATETIME NOT NULL,
    used_at        DATETIME,
    invalidated_at DATETIME,
    created_at     DATETIME NOT NULL,
    FOREIGN KEY (member_id) REFERENCES members(id)
);
```

### 4.5 ERD (Entity Relationship Diagram)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Member      â”‚       â”‚    MemberBlock       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â—„â”€â”€â”¬â”€â”€â”€â”‚ blocker_id (FK)      â”‚
â”‚ email           â”‚   â”‚   â”‚ blocked_id (FK)      â”‚
â”‚ password        â”‚   â””â”€â”€â”€â”‚                      â”‚
â”‚ nickname        â”‚       â”‚ created_at           â”‚
â”‚ role            â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ profile         â”‚
â”‚ deleted_at      â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ MemberPasswordHistoryâ”‚
        â–²                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                 â”‚ member_id (FK)       â”‚
        â”‚                 â”‚ password             â”‚
        â”‚                 â”‚ changed_at           â”‚
        â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚  PasswordResetToken  â”‚
        â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ member_id (FK)       â”‚
                          â”‚ token                â”‚
                          â”‚ expires_at           â”‚
                          â”‚ used_at              â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. API ëª…ì„¸

### 5.1 ì¸ì¦ API

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| POST | `/api/v1/auth/login` | ë¡œê·¸ì¸ | âŒ |
| POST | `/api/v1/auth/logout` | ë¡œê·¸ì•„ì›ƒ | âœ… |
| POST | `/api/v1/auth/password-reset` | ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ | âŒ |
| POST | `/api/v1/auth/password-reset/confirm` | ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í™•ì¸ | âŒ |

### 5.2 íšŒì› API

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| POST | `/api/v1/members` | íšŒì›ê°€ì… | âŒ |
| GET | `/api/v1/members/me` | ë‚´ ì •ë³´ ì¡°íšŒ | âœ… |
| PATCH | `/api/v1/members/me` | ë‚´ ì •ë³´ ìˆ˜ì • | âœ… |
| DELETE | `/api/v1/members/me` | íšŒì› íƒˆí‡´ | âœ… |
| GET | `/api/v1/members/{id}` | ë‹¤ë¥¸ íšŒì› ì¡°íšŒ | âœ… |
| PATCH | `/api/v1/members/me/password` | ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ | âœ… |

### 5.3 ì°¨ë‹¨ API

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| POST | `/api/v1/members/blocks` | íšŒì› ì°¨ë‹¨ | âœ… |
| DELETE | `/api/v1/members/blocks/{blockedMemberId}` | ì°¨ë‹¨ í•´ì œ | âœ… |
| GET | `/api/v1/members/blocks` | ì°¨ë‹¨ ëª©ë¡ ì¡°íšŒ | âœ… |

### 5.4 ìš”ì²­/ì‘ë‹µ ì˜ˆì‹œ

#### íšŒì›ê°€ì… (POST /api/v1/members)
```json
// Request
{
  "email": "user@example.com",
  "password": "Password123!",
  "passwordConfirm": "Password123!",
  "nickname": "í…ŒìŠ¤íŠ¸ìœ ì €"
}

// Response (201 Created)
{
  "id": 1,
  "email": "user@example.com",
  "nickname": "í…ŒìŠ¤íŠ¸ìœ ì €",
  "role": "USER",
  "joinedAt": "2024-12-06T10:30:00"
}
```

#### ë¡œê·¸ì¸ (POST /api/v1/auth/login)
```json
// Request
{
  "email": "user@example.com",
  "password": "Password123!"
}

// Response
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "tokenType": "Bearer",
  "expiresIn": 3600000
}
```

---

## 6. í•µì‹¬ êµ¬í˜„ ìƒì„¸

### 6.1 íšŒì›ê°€ì… (MEM-01)

```java
@Service
@RequiredArgsConstructor
public class MemberService {
    
    private final MemberRepository memberRepository;
    private final PasswordEncoder passwordEncoder;
    
    @Transactional
    public MemberResponse createMember(CreateMemberRequest request) {
        // 1. ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬
        if (memberRepository.existsByEmail(request.getEmail())) {
            throw new DuplicateEmailException();
        }
        
        // 2. ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬
        if (memberRepository.existsByNickname(request.getNickname())) {
            throw new DuplicateNicknameException();
        }
        
        // 3. ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” (BCrypt)
        String encodedPassword = passwordEncoder.encode(request.getPassword());
        
        // 4. íšŒì› ìƒì„±
        Member member = Member.builder()
                .email(request.getEmail())
                .password(encodedPassword)
                .nickname(request.getNickname())
                .role(MemberRole.USER)
                .build();
        
        return new MemberResponse(memberRepository.save(member));
    }
}
```

### 6.2 JWT í† í° ìƒì„± (MEM-02)

```java
@Component
public class JwtTokenProvider {
    
    private final SecretKey key;
    private final long expirationMillis;
    
    public String createToken(Long memberId, MemberRole role) {
        Date now = new Date();
        Date expiry = new Date(now.getTime() + expirationMillis);
        
        return Jwts.builder()
                .subject(String.valueOf(memberId))
                .claim("role", role.name())
                .issuedAt(now)
                .expiration(expiry)
                .signWith(key, Jwts.SIG.HS256)
                .compact();
    }
    
    public Long getMemberId(String token) {
        Claims claims = Jwts.parser()
                .verifyWith(key)
                .build()
                .parseSignedClaims(token)
                .getPayload();
        return Long.parseLong(claims.getSubject());
    }
}
```

### 6.3 ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (MEM-07)

```java
@Transactional
public void changePassword(Long memberId, ChangePasswordRequest request) {
    Member member = getMemberById(memberId);
    
    // 1. í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
    if (!passwordEncoder.matches(request.getCurrentPassword(), member.getPassword())) {
        throw new InvalidPasswordException();
    }
    
    // 2. í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ì™€ ë™ì¼í•œì§€ ì²´í¬
    if (passwordEncoder.matches(request.getNewPassword(), member.getPassword())) {
        throw new SameAsCurrentPasswordException();
    }
    
    // 3. ìµœê·¼ 5ê°œ ë¹„ë°€ë²ˆí˜¸ ì¬ì‚¬ìš© ì²´í¬
    List<MemberPasswordHistory> histories = 
        passwordHistoryRepository.findTop5ByMemberOrderByChangedAtDesc(member);
    for (MemberPasswordHistory history : histories) {
        if (passwordEncoder.matches(request.getNewPassword(), history.getPassword())) {
            throw new PasswordRecentlyUsedException();
        }
    }
    
    // 4. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    String encodedPassword = passwordEncoder.encode(request.getNewPassword());
    member.changePassword(encodedPassword);
    
    // 5. ë¹„ë°€ë²ˆí˜¸ ì´ë ¥ ì €ì¥
    passwordHistoryRepository.save(
        new MemberPasswordHistory(member, encodedPassword, LocalDateTime.now())
    );
    
    // 6. ì´ë ¥ ì •ë¦¬ (ìµœê·¼ 5ê°œë§Œ ìœ ì§€)
    prunePasswordHistory(member);
}
```

### 6.4 Soft Delete (MEM-06)

```java
@Entity
@SQLRestriction("deleted_at IS NULL")  // ìë™ìœ¼ë¡œ ì‚­ì œëœ íšŒì› ì œì™¸
public class Member {
    
    @Column
    private LocalDateTime deletedAt;
    
    public void markAsDeleted() {
        this.deletedAt = LocalDateTime.now();
    }
    
    public boolean isDeleted() {
        return deletedAt != null;
    }
}
```

---

## 7. ë³´ì•ˆ ê¸°ëŠ¥

### 7.1 ë¹„ë°€ë²ˆí˜¸ ì •ì±… (@Password)

```java
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = PasswordValidator.class)
public @interface Password {
    String message() default "ë¹„ë°€ë²ˆí˜¸ëŠ” 8-20ìì´ë©°, ëŒ€ì†Œë¬¸ì/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ê°€ì§€ ì´ìƒ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤";
}

public class PasswordValidator implements ConstraintValidator<Password, String> {
    
    private static final String ALLOWED_CHARS = "A-Za-z0-9!@#$%^&*";
    private static final Pattern PATTERN = Pattern.compile("^[" + ALLOWED_CHARS + "]{8,20}$");
    
    @Override
    public boolean isValid(String value, ConstraintValidatorContext context) {
        if (value == null) return false;
        if (!PATTERN.matcher(value).matches()) return false;
        
        int categoryCount = 0;
        if (value.matches(".*[A-Z].*")) categoryCount++;  // ëŒ€ë¬¸ì
        if (value.matches(".*[a-z].*")) categoryCount++;  // ì†Œë¬¸ì
        if (value.matches(".*[0-9].*")) categoryCount++;  // ìˆ«ì
        if (value.matches(".*[!@#$%^&*].*")) categoryCount++;  // íŠ¹ìˆ˜ë¬¸ì
        
        return categoryCount >= 2;
    }
}
```

### 7.2 í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸

```java
@Service
public class TokenBlacklistService {
    
    // ConcurrentHashMapìœ¼ë¡œ ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë³´ì¥
    private final ConcurrentHashMap<String, Long> blacklist = new ConcurrentHashMap<>();
    
    public void blacklist(String token, Long expirationTime) {
        blacklist.put(token, expirationTime);
        cleanupExpired();  // Lazy cleanup
    }
    
    public boolean isBlacklisted(String token) {
        Long expiry = blacklist.get(token);
        if (expiry == null) return false;
        if (expiry < System.currentTimeMillis()) {
            blacklist.remove(token);
            return false;
        }
        return true;
    }
}
```

### 7.3 ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í† í°

```java
@Entity
public class PasswordResetToken {
    
    private static final int TOKEN_BYTES = 48;  // 384 bits
    private static final Duration TOKEN_TTL = Duration.ofMinutes(30);
    
    public static PasswordResetToken create(Member member) {
        byte[] randomBytes = new byte[TOKEN_BYTES];
        new SecureRandom().nextBytes(randomBytes);
        String token = Base64.getUrlEncoder().withoutPadding().encodeToString(randomBytes);
        
        return PasswordResetToken.builder()
                .member(member)
                .token(token)
                .expiresAt(LocalDateTime.now().plus(TOKEN_TTL))
                .build();
    }
    
    public boolean isValid() {
        return !isExpired() && !isUsed() && !isInvalidated();
    }
}
```

---

## 8. ë””ìì¸ íŒ¨í„´

### 8.1 Builder íŒ¨í„´
- **ì ìš©**: Member, DTO í´ë˜ìŠ¤
- **ì¥ì **: ê°€ë…ì„± í–¥ìƒ, ë¶ˆë³€ ê°ì²´ ìƒì„±

### 8.2 Repository íŒ¨í„´
- **ì ìš©**: ëª¨ë“  Repository ì¸í„°í˜ì´ìŠ¤
- **ì¥ì **: ë°ì´í„° ì ‘ê·¼ ë¡œì§ ì¶”ìƒí™”

### 8.3 Strategy íŒ¨í„´
- **ì ìš©**: ì»¤ìŠ¤í…€ Validator
- **ì¥ì **: ê²€ì¦ ë¡œì§ í™•ì¥ ìš©ì´

### 8.4 Filter Chain íŒ¨í„´
- **ì ìš©**: JWT í•„í„°
- **ì¥ì **: ì¸ì¦/ì¸ê°€ ë¡œì§ ë¶„ë¦¬

### 8.5 Soft Delete íŒ¨í„´
- **ì ìš©**: Member.deletedAt
- **ì¥ì **: ë°ì´í„° ë³µêµ¬ ê°€ëŠ¥, ì°¸ì¡° ë¬´ê²°ì„± ìœ ì§€

---

## 9. ì˜ˆìƒ ì§ˆë¬¸ ë° ë‹µë³€

### Q1: BCryptë¥¼ ì„ íƒí•œ ì´ìœ ëŠ”?
**A:** 
- **Adaptive í•´ì‹œ**: work factor ì¡°ì ˆë¡œ ë³´ì•ˆ ê°•ë„ ì¡°ì ˆ ê°€ëŠ¥
- **Salt ë‚´ì¥**: ê°™ì€ ë¹„ë°€ë²ˆí˜¸ë„ ë‹¤ë¥¸ í•´ì‹œê°’ ìƒì„±
- **ëŠë¦° í•´ì‹œ**: Brute-force ê³µê²© ë°©ì–´
- **Spring Security ê¸°ë³¸ ì§€ì›**

### Q2: JWT í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í–ˆë‚˜ìš”?
**A:**
- `ConcurrentHashMap`ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê¸°ë°˜ êµ¬í˜„
- í† í° â†’ ë§Œë£Œì‹œê°„ ë§¤í•‘
- Lazy cleanupìœ¼ë¡œ ë§Œë£Œëœ í† í° ìë™ ì œê±°
- **ë‹¨ì **: ì„œë²„ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”ë¨
- **ê°œì„  ë°©í–¥**: Redis ì‚¬ìš© ì‹œ ì˜ì†ì„±/í´ëŸ¬ìŠ¤í„° ì§€ì›

### Q3: ë¹„ë°€ë²ˆí˜¸ ì¬ì‚¬ìš© ë°©ì§€ë¥¼ ì™œ êµ¬í˜„í–ˆë‚˜ìš”?
**A:**
- **ë³´ì•ˆ ìš”êµ¬ì‚¬í•­**: ê³¼ê±° ë¹„ë°€ë²ˆí˜¸ ì¬ì‚¬ìš© ì‹œ ë³´ì•ˆ ì·¨ì•½
- **êµ¬í˜„**: ìµœê·¼ 5ê°œ ë¹„ë°€ë²ˆí˜¸ ì´ë ¥ ì €ì¥
- **ìë™ ì •ë¦¬**: 5ê°œ ì´ˆê³¼ ì‹œ ì˜¤ë˜ëœ ì´ë ¥ ì‚­ì œ

### Q4: Soft Deleteë¥¼ ì„ íƒí•œ ì´ìœ ëŠ”?
**A:**
| í•­ëª© | Hard Delete | Soft Delete |
|------|-------------|-------------|
| ë³µêµ¬ | ë¶ˆê°€ëŠ¥ | ê°€ëŠ¥ |
| FK ì°¸ì¡° | ì‚­ì œ ì‹œ ë¬¸ì œ | ìœ ì§€ |
| ì €ì¥ ê³µê°„ | ì ˆì•½ | ì¦ê°€ |
| ì¿¼ë¦¬ ì„±ëŠ¥ | ë¹ ë¦„ | WHERE ì¡°ê±´ ì¶”ê°€ í•„ìš” |

íšŒì› íƒˆí‡´ í›„ì—ë„ ê²Œì‹œë¬¼, ëŒ“ê¸€ ë“±ì˜ ì°¸ì¡° ë¬´ê²°ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ Soft Delete ì„ íƒ.

### Q5: ë¹„ë°€ë²ˆí˜¸ ì •ì±…ì˜ ê¸°ì¤€ì€?
**A:**
- **ê¸¸ì´**: 8-20ì (NIST ê¶Œì¥: ìµœì†Œ 8ì)
- **ë³µì¡ë„**: 4ê°€ì§€ ì¹´í…Œê³ ë¦¬ ì¤‘ 2ê°€ì§€ ì´ìƒ
  - ëŒ€ë¬¸ì (A-Z)
  - ì†Œë¬¸ì (a-z)
  - ìˆ«ì (0-9)
  - íŠ¹ìˆ˜ë¬¸ì (!@#$%^&*)
- **ì´ë ¥ ì œí•œ**: ìµœê·¼ 5ê°œ ì¬ì‚¬ìš© ê¸ˆì§€

### Q6: JWT vs Sessionì˜ ì„ íƒ ê¸°ì¤€ì€?
**A:**
- **JWT ì„ íƒ ì´ìœ **:
  1. REST APIì˜ ë¬´ìƒíƒœ(Stateless) íŠ¹ì„±
  2. í”„ë¡ íŠ¸ì—”ë“œ(React)ì™€ì˜ ë¶„ë¦¬
  3. ìˆ˜í‰ í™•ì¥ ìš©ì´
  4. ëª¨ë°”ì¼ ì•± í™•ì¥ ê³ ë ¤

### Q7: íšŒì› ì°¨ë‹¨ ê¸°ëŠ¥ì˜ í™œìš©ì²˜ëŠ”?
**A:**
- ì°¨ë‹¨í•œ ì‚¬ìš©ìì˜ ê²Œì‹œë¬¼/ëŒ“ê¸€ ìˆ¨ê¹€
- ì°¨ë‹¨í•œ ì‚¬ìš©ìë¡œë¶€í„°ì˜ ë©”ì‹œì§€ ì°¨ë‹¨
- í”¼ë“œì—ì„œ í•´ë‹¹ ì‚¬ìš©ì ì½˜í…ì¸  ì œì™¸

### Q8: MemberRoleì˜ ì—­í• ë³„ ê¶Œí•œì€?
**A:**
| Role | ê¶Œí•œ |
|------|------|
| USER | ì¼ë°˜ ì‚¬ìš©ì ê¸°ëŠ¥ |
| MODERATOR | ê²Œì‹œë¬¼/ëŒ“ê¸€ ê´€ë¦¬ |
| SUB_MODERATOR | ì œí•œëœ ê´€ë¦¬ ê¸°ëŠ¥ |
| ADMIN | ì „ì²´ ì‹œìŠ¤í…œ ê´€ë¦¬ |

---

## ğŸ“ ê´€ë ¨ íŒŒì¼ ëª©ë¡

| ì¹´í…Œê³ ë¦¬ | íŒŒì¼ | ìš©ë„ |
|----------|------|------|
| Controller | MemberController.java | íšŒì›ê°€ì… API |
| Controller | AuthController.java | ë¡œê·¸ì¸ API |
| Controller | LogoutController.java | ë¡œê·¸ì•„ì›ƒ API |
| Controller | MemberProfileController.java | í”„ë¡œí•„ ê´€ë¦¬ API |
| Controller | MemberBlockController.java | ì°¨ë‹¨ API |
| Controller | PasswordResetController.java | ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° API |
| Service | MemberService.java | íšŒì› ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ |
| Service | AuthService.java | ì¸ì¦ ë¡œì§ |
| Service | MemberBlockService.java | ì°¨ë‹¨ ë¡œì§ |
| Service | PasswordResetService.java | ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • |
| Entity | Member.java | íšŒì› ì—”í‹°í‹° |
| Entity | MemberPasswordHistory.java | ë¹„ë°€ë²ˆí˜¸ ì´ë ¥ |
| Entity | PasswordResetToken.java | ì¬ì„¤ì • í† í° |
| Security | JwtTokenProvider.java | JWT í† í° ì²˜ë¦¬ |
| Security | JwtAuthenticationFilter.java | ì¸ì¦ í•„í„° |
| Validation | PasswordValidator.java | ë¹„ë°€ë²ˆí˜¸ ì •ì±… |
