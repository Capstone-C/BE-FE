# ëƒ‰ì¥ê³  ê´€ë ¨ ê¸°ëŠ¥ (Issue #70)

> **GitHub Issue**: https://github.com/Capstone-C/BE-FE/issues/70  
> **ë‹´ë‹¹ì**: qoweh  
> **ìƒíƒœ**: Open (8ê°œ ì„œë¸Œì´ìŠˆ ì¤‘ 0ê°œ ì™„ë£Œ)

---

## ğŸ“‹ ëª©ì°¨
1. [ê¸°ëŠ¥ ê°œìš”](#1-ê¸°ëŠ¥-ê°œìš”)
2. [ì„œë¸Œ ì´ìŠˆ ëª©ë¡](#2-ì„œë¸Œ-ì´ìŠˆ-ëª©ë¡)
3. [íŒŒì¼ êµ¬ì¡°](#3-íŒŒì¼-êµ¬ì¡°)
4. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#4-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
5. [API ëª…ì„¸](#5-api-ëª…ì„¸)
6. [í•µì‹¬ êµ¬í˜„ ìƒì„¸](#6-í•µì‹¬-êµ¬í˜„-ìƒì„¸)
7. [Gemini AI ì—°ë™](#7-gemini-ai-ì—°ë™)
8. [ë””ìì¸ íŒ¨í„´](#8-ë””ìì¸-íŒ¨í„´)
9. [ì˜ˆìƒ ì§ˆë¬¸ ë° ë‹µë³€](#9-ì˜ˆìƒ-ì§ˆë¬¸-ë°-ë‹µë³€)

---

## 1. ê¸°ëŠ¥ ê°œìš”

ëƒ‰ì¥ê³  ëª¨ë“ˆì€ ì‚¬ìš©ìì˜ ì‹ì¬ë£Œë¥¼ ê´€ë¦¬í•˜ê³ , AI ê¸°ë°˜ ì˜ìˆ˜ì¦ ì¸ì‹ ë° ë ˆì‹œí”¼ ì¶”ì²œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥
- **ì¬ë£Œ CRUD**: ëƒ‰ì¥ê³  ì¬ë£Œ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ/ì¡°íšŒ
- **ì˜ìˆ˜ì¦ OCR**: Google Gemini Vision APIë¡œ ì˜ìˆ˜ì¦ ìë™ ì¸ì‹
- **ì¬ë£Œ ë³‘í•©**: ì¤‘ë³µ ì¬ë£Œ ìë™ í•©ì‚° (ê¸°ì¡´ + ì‹ ê·œ)
- **ë ˆì‹œí”¼ ì¶”ì²œ**: ë³´ìœ  ì¬ë£Œ ê¸°ë°˜ ë ˆì‹œí”¼ ê²€ìƒ‰
- **ì¬ë£Œ ì°¨ê°**: ë ˆì‹œí”¼ ì¡°ë¦¬ ì‹œ ì¬ë£Œ ìë™ ì°¨ê°

### ê¸°ìˆ ì  íŠ¹ì§•
- **AI Vision API**: Google Gemini 2.5 Flash
- **Fuzzy Matching**: ë ˆì‹œí”¼ ì¬ë£Œ-ëƒ‰ì¥ê³  ì¬ë£Œ ë§¤ì¹­
- **ì°¨ê° ë¯¸ë¦¬ë³´ê¸°**: ì¡°ë¦¬ ì „ ì°¨ê° ê²°ê³¼ í™•ì¸

---

## 2. ì„œë¸Œ ì´ìŠˆ ëª©ë¡

| ì´ìŠˆ | ì œëª© | ìƒíƒœ |
|------|------|------|
| #71 | REF-01: ëƒ‰ì¥ê³  ì¬ë£Œ ëª©ë¡ ì¡°íšŒ | ğŸ”„ ì§„í–‰ì¤‘ |
| #72 | REF-02: ëƒ‰ì¥ê³  ì¬ë£Œ ì¶”ê°€ | ğŸ”„ ì§„í–‰ì¤‘ |
| #73 | REF-03: ëƒ‰ì¥ê³  ì¬ë£Œ ìˆ˜ì • | ğŸ”„ ì§„í–‰ì¤‘ |
| #74 | REF-04: ëƒ‰ì¥ê³  ì¬ë£Œ ì‚­ì œ | ğŸ”„ ì§„í–‰ì¤‘ |
| #75 | REF-05: ì˜ìˆ˜ì¦ ìŠ¤ìº” (Gemini OCR) | ğŸ”„ ì§„í–‰ì¤‘ |
| #76 | REF-06: ë³´ìœ  ì¬ë£Œ ê¸°ë°˜ ë ˆì‹œí”¼ ì¶”ì²œ | ğŸ”„ ì§„í–‰ì¤‘ |
| #77 | REF-07: ë ˆì‹œí”¼ ê¸°ë°˜ ì¬ë£Œ ì°¨ê° ë¯¸ë¦¬ë³´ê¸° | ğŸ”„ ì§„í–‰ì¤‘ |
| #78 | REF-08: ë ˆì‹œí”¼ ê¸°ë°˜ ì¬ë£Œ ì°¨ê° ì‹¤í–‰ | ğŸ”„ ì§„í–‰ì¤‘ |

---

## 3. íŒŒì¼ êµ¬ì¡°

```
/CC_BE/src/main/java/com/capstone/web/refrigerator/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ GeminiConfig.java                      # Gemini API ì„¤ì •
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ RefrigeratorController.java            # REST API
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ RefrigeratorItem.java                  # ì¬ë£Œ ì—”í‹°í‹°
â”‚   â””â”€â”€ RefrigeratorItemRepository.java        # JPA Repository
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ request/
â”‚   â”‚   â”œâ”€â”€ IngredientRequest.java             # ì¬ë£Œ ì¶”ê°€/ìˆ˜ì • ìš”ì²­
â”‚   â”‚   â”œâ”€â”€ IngredientsAddRequest.java         # ë³µìˆ˜ ì¬ë£Œ ì¶”ê°€
â”‚   â”‚   â””â”€â”€ DeductionRequest.java              # ì°¨ê° ìš”ì²­
â”‚   â””â”€â”€ response/
â”‚       â”œâ”€â”€ IngredientResponse.java            # ì¬ë£Œ ì‘ë‹µ
â”‚       â”œâ”€â”€ ReceiptScanResponse.java           # ì˜ìˆ˜ì¦ ìŠ¤ìº” ê²°ê³¼
â”‚       â”œâ”€â”€ RecommendationDto.java             # ë ˆì‹œí”¼ ì¶”ì²œ
â”‚       â””â”€â”€ DeductionDto.java                  # ì°¨ê° ë¯¸ë¦¬ë³´ê¸°
â”œâ”€â”€ exception/
â”‚   â”œâ”€â”€ GeminiApiException.java                # Gemini ì˜¤ë¥˜
â”‚   â””â”€â”€ ReceiptParseException.java             # ì˜ìˆ˜ì¦ íŒŒì‹± ì˜¤ë¥˜
â””â”€â”€ service/
    â”œâ”€â”€ GeminiService.java                     # Gemini API í´ë¼ì´ì–¸íŠ¸
    â””â”€â”€ RefrigeratorService.java               # í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
```

---

## 4. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 4.1 ì „ì²´ íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚â”€â”€â”€â”€â–ºâ”‚  Refrigerator    â”‚â”€â”€â”€â”€â–ºâ”‚ Refrigerator      â”‚
â”‚   (React)    â”‚     â”‚  Controller      â”‚     â”‚ Service           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                                  â”‚               â”‚
                     â–¼                                  â–¼               â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ GeminiServiceâ”‚                â”‚ Repository  â”‚   â”‚ RecipeServiceâ”‚
              â”‚ (Vision API) â”‚                â”‚ (JPA/MySQL) â”‚   â”‚ (ì¶”ì²œ ê²€ìƒ‰)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     Google Gemini API                â”‚
              â”‚  generativelanguage.googleapis.com   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ì˜ìˆ˜ì¦ ìŠ¤ìº” íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì˜ìˆ˜ì¦ ì´ë¯¸ì§€    â”‚
â”‚  (Base64/URL)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               GeminiService                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. í”„ë¡¬í”„íŠ¸ êµ¬ì„± (SYSTEM_INSTRUCTION)             â”‚
â”‚ 2. Gemini Vision API í˜¸ì¶œ                        â”‚
â”‚ 3. JSON ì‘ë‹µ íŒŒì‹±                                 â”‚
â”‚ 4. PurchasedItem ëª©ë¡ ë°˜í™˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           RefrigeratorService                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ê¸°ì¡´ ì¬ë£Œ ì¡°íšŒ (findByMemberIdAndName)         â”‚
â”‚ 2. ì¤‘ë³µ í™•ì¸ ë° ë³‘í•© ë¡œì§                          â”‚
â”‚    - ë™ì¼ ì´ë¦„ â†’ ìˆ˜ëŸ‰ í•©ì‚°                         â”‚
â”‚    - ìƒˆ ì¬ë£Œ â†’ ì‹ ê·œ ì €ì¥                          â”‚
â”‚ 3. ì €ì¥ ê²°ê³¼ ë°˜í™˜                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ì¬ë£Œ ì°¨ê° íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë ˆì‹œí”¼ ì„ íƒ      â”‚
â”‚  (recipeId)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               RefrigeratorService                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ previewDeduction(memberId, recipeId)              â”‚
â”‚ 1. ë ˆì‹œí”¼ ì¬ë£Œ ëª©ë¡ ì¡°íšŒ                           â”‚
â”‚ 2. ì‚¬ìš©ì ëƒ‰ì¥ê³  ì¬ë£Œ ì¡°íšŒ                         â”‚
â”‚ 3. Fuzzy Matchingìœ¼ë¡œ ë§¤ì¹­                        â”‚
â”‚ 4. ì°¨ê° ê°€ëŠ¥ ì—¬ë¶€ íŒë‹¨                            â”‚
â”‚ 5. ë¯¸ë¦¬ë³´ê¸° ê²°ê³¼ ë°˜í™˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ (ì‚¬ìš©ì í™•ì¸)
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ executeDeduction(memberId, deductionRequest)      â”‚
â”‚ 1. ë¯¸ë¦¬ë³´ê¸°ì™€ ë™ì¼ ë¡œì§                           â”‚
â”‚ 2. ì‹¤ì œ ìˆ˜ëŸ‰ ì°¨ê°                                 â”‚
â”‚ 3. ìˆ˜ëŸ‰ 0 ì´í•˜ â†’ ì‚­ì œ                            â”‚
â”‚ 4. ì°¨ê° ê²°ê³¼ ë°˜í™˜                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. API ëª…ì„¸

### 5.1 ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| GET | `/api/v1/refrigerator/items` | ì¬ë£Œ ëª©ë¡ ì¡°íšŒ | âœ… í•„ìš” |
| POST | `/api/v1/refrigerator/items` | ì¬ë£Œ ì¶”ê°€ | âœ… í•„ìš” |
| PUT | `/api/v1/refrigerator/items/{id}` | ì¬ë£Œ ìˆ˜ì • | âœ… í•„ìš” |
| DELETE | `/api/v1/refrigerator/items/{id}` | ì¬ë£Œ ì‚­ì œ | âœ… í•„ìš” |
| POST | `/api/v1/refrigerator/scan` | ì˜ìˆ˜ì¦ ìŠ¤ìº” | âœ… í•„ìš” |
| GET | `/api/v1/refrigerator/recommendations` | ë ˆì‹œí”¼ ì¶”ì²œ | âœ… í•„ìš” |
| GET | `/api/v1/refrigerator/deduction/preview` | ì°¨ê° ë¯¸ë¦¬ë³´ê¸° | âœ… í•„ìš” |
| POST | `/api/v1/refrigerator/deduction/execute` | ì°¨ê° ì‹¤í–‰ | âœ… í•„ìš” |

### 5.2 REF-01: ì¬ë£Œ ëª©ë¡ ì¡°íšŒ

```http
GET /api/v1/refrigerator/items
Authorization: Bearer {token}
```

**ì‘ë‹µ:**
```json
{
  "items": [
    {
      "id": 1,
      "name": "ê³„ë€",
      "quantity": 10,
      "unit": "ê°œ",
      "expirationDate": "2024-12-15",
      "category": "DAIRY",
      "createdAt": "2024-12-01T10:00:00",
      "updatedAt": "2024-12-01T10:00:00"
    },
    {
      "id": 2,
      "name": "ìš°ìœ ",
      "quantity": 2,
      "unit": "L",
      "expirationDate": "2024-12-10",
      "category": "DAIRY"
    }
  ],
  "totalCount": 2
}
```

### 5.3 REF-02: ì¬ë£Œ ì¶”ê°€

```http
POST /api/v1/refrigerator/items
Content-Type: application/json
Authorization: Bearer {token}
```

**ìš”ì²­:**
```json
{
  "items": [
    {
      "name": "ë¼ì§€ê³ ê¸°",
      "quantity": 500,
      "unit": "g",
      "expirationDate": "2024-12-08",
      "category": "MEAT"
    }
  ]
}
```

**ì‘ë‹µ:**
```json
{
  "addedItems": [
    {
      "id": 3,
      "name": "ë¼ì§€ê³ ê¸°",
      "quantity": 500,
      "unit": "g",
      "expirationDate": "2024-12-08",
      "category": "MEAT",
      "merged": false
    }
  ],
  "mergedItems": []
}
```

### 5.4 REF-05: ì˜ìˆ˜ì¦ ìŠ¤ìº”

```http
POST /api/v1/refrigerator/scan
Content-Type: multipart/form-data
Authorization: Bearer {token}

image: [ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ íŒŒì¼]
```

**ì‘ë‹µ:**
```json
{
  "success": true,
  "parsedItems": [
    {
      "name": "ìœ ê¸°ë† ê³„ë€ 30êµ¬",
      "quantity": 1,
      "unitPrice": 12000,
      "totalPrice": 12000,
      "expirationDate": null
    },
    {
      "name": "ì„œìš¸ìš°ìœ  1L",
      "quantity": 2,
      "unitPrice": 2800,
      "totalPrice": 5600,
      "expirationDate": "2024-12-15"
    }
  ],
  "storeName": "ì´ë§ˆíŠ¸ ê°•ë‚¨ì ",
  "purchaseDate": "2024-12-06",
  "totalAmount": 17600
}
```

### 5.5 REF-06: ë ˆì‹œí”¼ ì¶”ì²œ

```http
GET /api/v1/refrigerator/recommendations?maxResults=10
Authorization: Bearer {token}
```

**ì‘ë‹µ:**
```json
{
  "recommendations": [
    {
      "recipeId": 123,
      "recipeName": "ê³„ë€ë§ì´",
      "matchedIngredients": ["ê³„ë€", "íŒŒ", "ì†Œê¸ˆ"],
      "missingIngredients": ["ì‹ìš©ìœ "],
      "matchRate": 75.0,
      "cookingTime": 15,
      "difficulty": "EASY"
    }
  ]
}
```

### 5.6 REF-07: ì°¨ê° ë¯¸ë¦¬ë³´ê¸°

```http
GET /api/v1/refrigerator/deduction/preview?recipeId=123
Authorization: Bearer {token}
```

**ì‘ë‹µ:**
```json
{
  "recipeId": 123,
  "recipeName": "ê³„ë€ë§ì´",
  "deductions": [
    {
      "ingredientId": 1,
      "ingredientName": "ê³„ë€",
      "recipeAmount": 3,
      "recipeUnit": "ê°œ",
      "currentQuantity": 10,
      "afterQuantity": 7,
      "canDeduct": true
    },
    {
      "ingredientId": null,
      "ingredientName": "ì‹ìš©ìœ ",
      "recipeAmount": 1,
      "recipeUnit": "í°ìˆ ",
      "currentQuantity": 0,
      "afterQuantity": 0,
      "canDeduct": false,
      "reason": "ëƒ‰ì¥ê³ ì— ì—†ìŒ"
    }
  ],
  "allDeductable": false,
  "partialDeductable": true
}
```

### 5.7 REF-08: ì°¨ê° ì‹¤í–‰

```http
POST /api/v1/refrigerator/deduction/execute
Content-Type: application/json
Authorization: Bearer {token}
```

**ìš”ì²­:**
```json
{
  "recipeId": 123,
  "deductions": [
    {
      "ingredientId": 1,
      "amount": 3
    }
  ]
}
```

**ì‘ë‹µ:**
```json
{
  "success": true,
  "deductedItems": [
    {
      "ingredientId": 1,
      "ingredientName": "ê³„ë€",
      "deductedAmount": 3,
      "remainingQuantity": 7
    }
  ],
  "deletedItems": []
}
```

---

## 6. í•µì‹¬ êµ¬í˜„ ìƒì„¸

### 6.1 RefrigeratorItem ì—”í‹°í‹°

```java
@Entity
@Table(name = "refrigerator_items")
@EntityListeners(AuditingEntityListener.class)
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class RefrigeratorItem {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "member_id", nullable = false)
    private Member member;
    
    @Column(nullable = false, length = 100)
    private String name;
    
    @Column(nullable = false)
    private Integer quantity;
    
    @Column(length = 20)
    private String unit;
    
    @Column
    private LocalDate expirationDate;
    
    @Enumerated(EnumType.STRING)
    @Column(length = 30)
    private IngredientCategory category;
    
    @CreatedDate
    @Column(updatable = false)
    private LocalDateTime createdAt;
    
    @LastModifiedDate
    private LocalDateTime updatedAt;
    
    @Builder
    public RefrigeratorItem(Member member, String name, Integer quantity, 
                           String unit, LocalDate expirationDate,
                           IngredientCategory category) {
        this.member = member;
        this.name = name;
        this.quantity = quantity;
        this.unit = unit;
        this.expirationDate = expirationDate;
        this.category = category;
    }
    
    // ìˆ˜ëŸ‰ ì¦ê°€ (ë³‘í•© ì‹œ ì‚¬ìš©)
    public void addQuantity(Integer amount) {
        this.quantity += amount;
    }
    
    // ìˆ˜ëŸ‰ ì°¨ê°
    public void deductQuantity(Integer amount) {
        if (this.quantity < amount) {
            throw new IllegalArgumentException("Insufficient quantity");
        }
        this.quantity -= amount;
    }
    
    // ìœ í†µê¸°í•œ ê°±ì‹  (ë” ê¸´ ìœ í†µê¸°í•œìœ¼ë¡œ)
    public void updateExpirationDateIfLonger(LocalDate newDate) {
        if (newDate != null) {
            if (this.expirationDate == null || newDate.isAfter(this.expirationDate)) {
                this.expirationDate = newDate;
            }
        }
    }
}
```

### 6.2 RefrigeratorService - í•µì‹¬ ë¡œì§

```java
@Service
@RequiredArgsConstructor
@Transactional
@Slf4j
public class RefrigeratorService {
    
    private final RefrigeratorItemRepository refrigeratorItemRepository;
    private final GeminiService geminiService;
    private final RecipeRepository recipeRepository;
    
    // ========== REF-01: ëª©ë¡ ì¡°íšŒ ==========
    @Transactional(readOnly = true)
    public List<IngredientResponse> getItems(Long memberId) {
        return refrigeratorItemRepository.findByMemberId(memberId).stream()
                .map(IngredientResponse::from)
                .sorted(Comparator.comparing(IngredientResponse::getExpirationDate,
                        Comparator.nullsLast(Comparator.naturalOrder())))
                .collect(Collectors.toList());
    }
    
    // ========== REF-02: ì¬ë£Œ ì¶”ê°€ (ë³‘í•© ë¡œì§ í¬í•¨) ==========
    public AddItemsResult addItems(Long memberId, IngredientsAddRequest request) {
        Member member = getMember(memberId);
        
        List<IngredientResponse> addedItems = new ArrayList<>();
        List<IngredientResponse> mergedItems = new ArrayList<>();
        
        for (IngredientRequest item : request.getItems()) {
            // ë™ì¼ ì´ë¦„ ì¬ë£Œ ê²€ìƒ‰
            Optional<RefrigeratorItem> existing = 
                refrigeratorItemRepository.findByMemberIdAndNameIgnoreCase(
                    memberId, item.getName().trim());
            
            if (existing.isPresent()) {
                // ë³‘í•©: ìˆ˜ëŸ‰ í•©ì‚°, ìœ í†µê¸°í•œ ê°±ì‹ 
                RefrigeratorItem existingItem = existing.get();
                existingItem.addQuantity(item.getQuantity());
                existingItem.updateExpirationDateIfLonger(item.getExpirationDate());
                
                mergedItems.add(IngredientResponse.from(existingItem));
                log.info("Merged ingredient: {} (+{} = {})", 
                    item.getName(), item.getQuantity(), existingItem.getQuantity());
            } else {
                // ì‹ ê·œ ì €ì¥
                RefrigeratorItem newItem = RefrigeratorItem.builder()
                        .member(member)
                        .name(item.getName().trim())
                        .quantity(item.getQuantity())
                        .unit(item.getUnit())
                        .expirationDate(item.getExpirationDate())
                        .category(item.getCategory())
                        .build();
                
                refrigeratorItemRepository.save(newItem);
                addedItems.add(IngredientResponse.from(newItem));
            }
        }
        
        return new AddItemsResult(addedItems, mergedItems);
    }
    
    // ========== REF-05: ì˜ìˆ˜ì¦ ìŠ¤ìº” ==========
    public ReceiptScanResponse scanReceipt(Long memberId, MultipartFile image) {
        // 1. Geminië¡œ ì˜ìˆ˜ì¦ íŒŒì‹±
        List<PurchasedItem> parsedItems = geminiService.parseReceipt(image);
        
        // 2. ëƒ‰ì¥ê³ ì— ì¶”ê°€ (ë³‘í•© ì²˜ë¦¬)
        IngredientsAddRequest request = convertToRequest(parsedItems);
        AddItemsResult result = addItems(memberId, request);
        
        // 3. ê²°ê³¼ ë°˜í™˜
        return ReceiptScanResponse.builder()
                .success(true)
                .parsedItems(parsedItems)
                .addedItems(result.getAddedItems())
                .mergedItems(result.getMergedItems())
                .build();
    }
    
    // ========== REF-06: ë ˆì‹œí”¼ ì¶”ì²œ ==========
    @Transactional(readOnly = true)
    public List<RecommendationDto> recommendRecipes(Long memberId, int maxResults) {
        // 1. ì‚¬ìš©ìì˜ ëƒ‰ì¥ê³  ì¬ë£Œ ì¡°íšŒ
        List<RefrigeratorItem> myItems = refrigeratorItemRepository.findByMemberId(memberId);
        Set<String> myIngredientNames = myItems.stream()
                .map(item -> item.getName().toLowerCase())
                .collect(Collectors.toSet());
        
        if (myIngredientNames.isEmpty()) {
            return Collections.emptyList();
        }
        
        // 2. ì „ì²´ ë ˆì‹œí”¼ì—ì„œ ë§¤ì¹­ë¥  ê³„ì‚°
        List<Recipe> allRecipes = recipeRepository.findAll();
        
        return allRecipes.stream()
                .map(recipe -> calculateMatch(recipe, myIngredientNames))
                .filter(dto -> dto.getMatchRate() > 0)  // ìµœì†Œ 1ê°œ ì´ìƒ ë§¤ì¹­
                .sorted(Comparator.comparing(RecommendationDto::getMatchRate).reversed())
                .limit(maxResults)
                .collect(Collectors.toList());
    }
    
    private RecommendationDto calculateMatch(Recipe recipe, Set<String> myIngredients) {
        List<String> recipeIngredients = recipe.getIngredients();
        
        List<String> matched = new ArrayList<>();
        List<String> missing = new ArrayList<>();
        
        for (String recipeIng : recipeIngredients) {
            String normalized = recipeIng.toLowerCase().trim();
            
            // Fuzzy Matching: í¬í•¨ ê´€ê³„ í™•ì¸
            boolean found = myIngredients.stream()
                    .anyMatch(myIng -> 
                        myIng.contains(normalized) || 
                        normalized.contains(myIng) ||
                        calculateSimilarity(myIng, normalized) > 0.7);
            
            if (found) {
                matched.add(recipeIng);
            } else {
                missing.add(recipeIng);
            }
        }
        
        double matchRate = (double) matched.size() / recipeIngredients.size() * 100;
        
        return RecommendationDto.builder()
                .recipeId(recipe.getId())
                .recipeName(recipe.getTitle())
                .matchedIngredients(matched)
                .missingIngredients(missing)
                .matchRate(matchRate)
                .cookingTime(recipe.getCookingTime())
                .difficulty(recipe.getDifficulty())
                .build();
    }
    
    // Levenshtein Distance ê¸°ë°˜ ìœ ì‚¬ë„
    private double calculateSimilarity(String s1, String s2) {
        int maxLen = Math.max(s1.length(), s2.length());
        if (maxLen == 0) return 1.0;
        
        int distance = levenshteinDistance(s1, s2);
        return 1.0 - ((double) distance / maxLen);
    }
    
    // ========== REF-07: ì°¨ê° ë¯¸ë¦¬ë³´ê¸° ==========
    @Transactional(readOnly = true)
    public DeductionDto previewDeduction(Long memberId, Long recipeId) {
        Recipe recipe = recipeRepository.findById(recipeId)
                .orElseThrow(() -> new ResourceNotFoundException("Recipe not found"));
        
        List<RefrigeratorItem> myItems = refrigeratorItemRepository.findByMemberId(memberId);
        Map<String, RefrigeratorItem> itemMap = myItems.stream()
                .collect(Collectors.toMap(
                    item -> item.getName().toLowerCase(),
                    item -> item,
                    (a, b) -> a  // ì¤‘ë³µ ì‹œ ì²« ë²ˆì§¸ ì‚¬ìš©
                ));
        
        List<DeductionItemDto> deductions = new ArrayList<>();
        boolean allDeductable = true;
        boolean anyDeductable = false;
        
        for (RecipeIngredient recipeIng : recipe.getRecipeIngredients()) {
            String ingName = recipeIng.getName().toLowerCase();
            Integer requiredAmount = recipeIng.getAmount();
            
            // Fuzzy ë§¤ì¹­ìœ¼ë¡œ ëƒ‰ì¥ê³  ì¬ë£Œ ì°¾ê¸°
            RefrigeratorItem matched = findMatchingItem(ingName, itemMap);
            
            DeductionItemDto.DeductionItemDtoBuilder builder = DeductionItemDto.builder()
                    .ingredientName(recipeIng.getName())
                    .recipeAmount(requiredAmount)
                    .recipeUnit(recipeIng.getUnit());
            
            if (matched != null) {
                int current = matched.getQuantity();
                int after = current - requiredAmount;
                boolean canDeduct = after >= 0;
                
                builder.ingredientId(matched.getId())
                       .currentQuantity(current)
                       .afterQuantity(Math.max(0, after))
                       .canDeduct(canDeduct);
                
                if (!canDeduct) {
                    builder.reason("ìˆ˜ëŸ‰ ë¶€ì¡± (í•„ìš”: " + requiredAmount + ", ë³´ìœ : " + current + ")");
                    allDeductable = false;
                } else {
                    anyDeductable = true;
                }
            } else {
                builder.ingredientId(null)
                       .currentQuantity(0)
                       .afterQuantity(0)
                       .canDeduct(false)
                       .reason("ëƒ‰ì¥ê³ ì— ì—†ìŒ");
                allDeductable = false;
            }
            
            deductions.add(builder.build());
        }
        
        return DeductionDto.builder()
                .recipeId(recipeId)
                .recipeName(recipe.getTitle())
                .deductions(deductions)
                .allDeductable(allDeductable)
                .partialDeductable(anyDeductable)
                .build();
    }
    
    // ========== REF-08: ì°¨ê° ì‹¤í–‰ ==========
    public DeductionResultDto executeDeduction(Long memberId, DeductionRequest request) {
        List<DeductedItemDto> deductedItems = new ArrayList<>();
        List<Long> deletedItemIds = new ArrayList<>();
        
        for (DeductionRequest.ItemDeduction itemDed : request.getDeductions()) {
            RefrigeratorItem item = refrigeratorItemRepository
                    .findByIdAndMemberId(itemDed.getIngredientId(), memberId)
                    .orElseThrow(() -> new ResourceNotFoundException("Item not found"));
            
            int prevQuantity = item.getQuantity();
            item.deductQuantity(itemDed.getAmount());
            
            if (item.getQuantity() <= 0) {
                // ìˆ˜ëŸ‰ 0 ì´í•˜ë©´ ì‚­ì œ
                refrigeratorItemRepository.delete(item);
                deletedItemIds.add(item.getId());
            }
            
            deductedItems.add(DeductedItemDto.builder()
                    .ingredientId(item.getId())
                    .ingredientName(item.getName())
                    .deductedAmount(itemDed.getAmount())
                    .remainingQuantity(Math.max(0, item.getQuantity()))
                    .build());
        }
        
        return DeductionResultDto.builder()
                .success(true)
                .deductedItems(deductedItems)
                .deletedItems(deletedItemIds)
                .build();
    }
    
    // Fuzzy ë§¤ì¹­ í—¬í¼
    private RefrigeratorItem findMatchingItem(String name, 
                                              Map<String, RefrigeratorItem> itemMap) {
        // ì •í™• ë§¤ì¹­
        if (itemMap.containsKey(name)) {
            return itemMap.get(name);
        }
        
        // í¬í•¨ ë§¤ì¹­
        for (Map.Entry<String, RefrigeratorItem> entry : itemMap.entrySet()) {
            if (entry.getKey().contains(name) || name.contains(entry.getKey())) {
                return entry.getValue();
            }
        }
        
        // ìœ ì‚¬ë„ ë§¤ì¹­
        return itemMap.entrySet().stream()
                .filter(e -> calculateSimilarity(e.getKey(), name) > 0.7)
                .map(Map.Entry::getValue)
                .findFirst()
                .orElse(null);
    }
}
```

---

## 7. Gemini AI ì—°ë™

### 7.1 GeminiService êµ¬í˜„

```java
@Service
@Slf4j
public class GeminiService {
    
    private static final String GEMINI_API_URL = 
        "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent";
    
    private static final String SYSTEM_INSTRUCTION = """
        ë‹¹ì‹ ì€ ì˜ìˆ˜ì¦ì„ ë¶„ì„í•˜ì—¬ êµ¬ë§¤í•œ ì‹í’ˆ í•­ëª©ì„ ì¶”ì¶œí•˜ëŠ” AIì…ë‹ˆë‹¤.
        
        ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ì—ì„œ ë‹¤ìŒ ì •ë³´ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”:
        1. ìƒí’ˆëª… (name): ì‹í’ˆ ì´ë¦„
        2. ìˆ˜ëŸ‰ (quantity): êµ¬ë§¤ ìˆ˜ëŸ‰ (ê¸°ë³¸ê°’: 1)
        3. ë‹¨ê°€ (unitPrice): ê°œë‹¹ ê°€ê²©
        4. ì´ì•¡ (totalPrice): í•´ë‹¹ í•­ëª©ì˜ ì´ ê¸ˆì•¡
        5. ìœ í†µê¸°í•œ (expirationDate): í‘œì‹œë˜ì–´ ìˆë‹¤ë©´ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ
        
        ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”. ë‹¤ë¥¸ í…ìŠ¤íŠ¸ëŠ” í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”:
        {
          "items": [
            {
              "name": "ìƒí’ˆëª…",
              "quantity": 1,
              "unitPrice": 1000,
              "totalPrice": 1000,
              "expirationDate": null
            }
          ],
          "storeName": "ë§¤ì¥ëª…",
          "purchaseDate": "2024-12-06",
          "totalAmount": 1000
        }
        
        ì£¼ì˜ì‚¬í•­:
        - ë¹„ì‹í’ˆ í•­ëª©(ì„¸ì œ, ìƒí™œìš©í’ˆ ë“±)ì€ ì œì™¸
        - ìƒí’ˆëª…ì—ì„œ ë¸Œëœë“œì™€ ìš©ëŸ‰ ì •ë³´ ìœ ì§€
        - ê¸ˆì•¡ì€ ìˆ«ìë§Œ (ì› ë‹¨ìœ„)
        - ìœ í†µê¸°í•œì´ ì—†ìœ¼ë©´ null
        - ë‚ ì§œê°€ ì˜ìˆ˜ì¦ì— ìˆë‹¤ë©´ ì •í™•íˆ ì¶”ì¶œ
        """;
    
    private final RestTemplate restTemplate;
    private final String apiKey;
    
    public GeminiService(
            RestTemplate restTemplate,
            @Value("${gemini.api.key:}") String apiKey) {
        this.restTemplate = restTemplate;
        this.apiKey = apiKey;
    }
    
    public List<PurchasedItem> parseReceipt(MultipartFile image) {
        if (!isConfigured()) {
            throw new GeminiApiException("Gemini API key not configured");
        }
        
        try {
            // 1. ì´ë¯¸ì§€ Base64 ì¸ì½”ë”©
            String base64Image = Base64.getEncoder()
                    .encodeToString(image.getBytes());
            String mimeType = image.getContentType();
            
            // 2. ìš”ì²­ ë³¸ë¬¸ êµ¬ì„±
            Map<String, Object> requestBody = buildRequestBody(base64Image, mimeType);
            
            // 3. API í˜¸ì¶œ
            String url = GEMINI_API_URL + "?key=" + apiKey;
            
            HttpHeaders headers = new HttpHeaders();
            headers.setContentType(MediaType.APPLICATION_JSON);
            
            HttpEntity<Map<String, Object>> entity = new HttpEntity<>(requestBody, headers);
            
            ResponseEntity<GeminiResponse> response = restTemplate.exchange(
                    url, HttpMethod.POST, entity, GeminiResponse.class);
            
            // 4. ì‘ë‹µ íŒŒì‹±
            return parseResponse(response.getBody());
            
        } catch (IOException e) {
            throw new GeminiApiException("Failed to process image", e);
        }
    }
    
    private Map<String, Object> buildRequestBody(String base64Image, String mimeType) {
        // System Instruction
        Map<String, Object> systemInstruction = Map.of(
            "parts", List.of(Map.of("text", SYSTEM_INSTRUCTION))
        );
        
        // Contents (ì´ë¯¸ì§€ + í”„ë¡¬í”„íŠ¸)
        Map<String, Object> imagePart = Map.of(
            "inline_data", Map.of(
                "mime_type", mimeType,
                "data", base64Image
            )
        );
        
        Map<String, Object> textPart = Map.of(
            "text", "ì´ ì˜ìˆ˜ì¦ì„ ë¶„ì„í•˜ì—¬ êµ¬ë§¤í•œ ì‹í’ˆ ëª©ë¡ì„ JSONìœ¼ë¡œ ì¶”ì¶œí•´ì£¼ì„¸ìš”."
        );
        
        Map<String, Object> contents = Map.of(
            "parts", List.of(imagePart, textPart)
        );
        
        // Generation Config
        Map<String, Object> generationConfig = Map.of(
            "temperature", 0.1,
            "maxOutputTokens", 4096,
            "responseMimeType", "application/json"
        );
        
        return Map.of(
            "system_instruction", systemInstruction,
            "contents", List.of(contents),
            "generationConfig", generationConfig
        );
    }
    
    private List<PurchasedItem> parseResponse(GeminiResponse response) {
        if (response == null || response.getCandidates() == null) {
            throw new ReceiptParseException("Empty response from Gemini");
        }
        
        String jsonText = response.getCandidates().get(0)
                .getContent().getParts().get(0).getText();
        
        log.debug("Gemini response: {}", jsonText);
        
        // JSON íŒŒì‹±
        ObjectMapper mapper = new ObjectMapper();
        mapper.registerModule(new JavaTimeModule());
        
        try {
            ReceiptParseResult result = mapper.readValue(jsonText, ReceiptParseResult.class);
            return result.getItems();
        } catch (JsonProcessingException e) {
            log.error("Failed to parse Gemini response: {}", jsonText, e);
            throw new ReceiptParseException("Failed to parse receipt data", e);
        }
    }
    
    private boolean isConfigured() {
        return apiKey != null && !apiKey.isBlank();
    }
}
```

### 7.2 Gemini ìš”ì²­/ì‘ë‹µ êµ¬ì¡°

**ìš”ì²­:**
```json
{
  "system_instruction": {
    "parts": [{"text": "ë‹¹ì‹ ì€ ì˜ìˆ˜ì¦ì„ ë¶„ì„í•˜ì—¬..."}]
  },
  "contents": [{
    "parts": [
      {
        "inline_data": {
          "mime_type": "image/jpeg",
          "data": "base64_encoded_image..."
        }
      },
      {
        "text": "ì´ ì˜ìˆ˜ì¦ì„ ë¶„ì„í•˜ì—¬..."
      }
    ]
  }],
  "generationConfig": {
    "temperature": 0.1,
    "maxOutputTokens": 4096,
    "responseMimeType": "application/json"
  }
}
```

**ì‘ë‹µ:**
```json
{
  "candidates": [{
    "content": {
      "parts": [{
        "text": "{\"items\":[{\"name\":\"ìœ ê¸°ë†ê³„ë€\"...}]}"
      }]
    }
  }]
}
```

### 7.3 í™˜ê²½ë³€ìˆ˜ ì„¤ì •

```yaml
# application.yml
gemini:
  api:
    key: ${GEMINI_API_KEY:}
```

---

## 8. ë””ìì¸ íŒ¨í„´

### 8.1 Repository Pattern
- **ì ìš©**: `RefrigeratorItemRepository`
- **ì¥ì **: ë°ì´í„° ì ‘ê·¼ ë¡œì§ ìº¡ìŠí™”

### 8.2 Builder Pattern
- **ì ìš©**: ëª¨ë“  DTO, Entity
- **ì¥ì **: ë³µì¡í•œ ê°ì²´ ìƒì„± ê°„ì†Œí™”

### 8.3 DTO Pattern
- **ì ìš©**: Request/Response DTO
- **ì¥ì **: API ê³„ì•½ê³¼ ë„ë©”ì¸ ë¶„ë¦¬

### 8.4 Facade Pattern
- **ì ìš©**: `RefrigeratorService`
- **ì—­í• **: GeminiService + Repository + RecipeService í†µí•©

### 8.5 Strategy Pattern (í™•ì¥ ê°€ëŠ¥)
- **í˜„ì¬**: GeminiServiceë§Œ êµ¬í˜„
- **í™•ì¥**: OCRService ì¸í„°í˜ì´ìŠ¤ë¡œ Naver CLOVA OCR ë“± ì¶”ê°€ ê°€ëŠ¥

---

## 9. ì˜ˆìƒ ì§ˆë¬¸ ë° ë‹µë³€

### Q1: ì™œ Google Geminië¥¼ ì„ íƒí–ˆë‚˜ìš”?
**A:**
| ë¹„êµ í•­ëª© | Gemini 2.5 Flash | GPT-4 Vision | Naver CLOVA |
|-----------|------------------|--------------|-------------|
| **ë¹„ìš©** | ë¬´ë£Œ í‹°ì–´ ìˆìŒ | ìœ ë£Œ | ìœ ë£Œ |
| **í•œêµ­ì–´** | ìš°ìˆ˜ | ìš°ìˆ˜ | ìš°ìˆ˜ |
| **ì†ë„** | ë¹ ë¦„ | ë³´í†µ | ë¹ ë¦„ |
| **JSON ì¶œë ¥** | ë„¤ì´í‹°ë¸Œ ì§€ì› | ê°€ëŠ¥ | ì¶”ê°€ ì²˜ë¦¬ í•„ìš” |

### Q2: ì˜ìˆ˜ì¦ ì¸ì‹ ì •í™•ë„ëŠ”?
**A:**
- **ë†’ì€ ì •í™•ë„**: ëª…í™•í•œ ì¸ì‡„ ì˜ìˆ˜ì¦ (ì´ë§ˆíŠ¸, ì¿ íŒ¡ ë“±)
- **ë‚®ì€ ì •í™•ë„**: ì†ê¸€ì”¨, íë¦° ì˜ìˆ˜ì¦, ë¹„ì •í˜• ë ˆì´ì•„ì›ƒ
- **ê°œì„  ë°©ì•ˆ**: í”„ë¡¬í”„íŠ¸ íŠœë‹, ì´ë¯¸ì§€ ì „ì²˜ë¦¬

### Q3: ì¬ë£Œ ë³‘í•© ë¡œì§ì˜ ë‹¨ìœ„ ë¶ˆì¼ì¹˜ëŠ”?
**A:**
```
ê¸°ì¡´: ê³„ë€ 10ê°œ
ì¶”ê°€: ê³„ë€ 1íŒ© (30ê°œ)

â†’ í˜„ì¬: ì´ë¦„ë§Œ ë¹„êµí•˜ë¯€ë¡œ "ê³„ë€ 11ê°œ"ê°€ ë¨ (ì˜ë„ì¹˜ ì•Šì€ ê²°ê³¼)
â†’ ê°œì„ : ë‹¨ìœ„ ë³€í™˜ ë¡œì§ ì¶”ê°€ í•„ìš”
```

**í˜„ì¬ êµ¬í˜„:**
```java
// ë‹¨ìœ„ ë¶ˆì¼ì¹˜ ì‹œ ê²½ê³  ë¡œê·¸
if (!existingItem.getUnit().equals(newItem.getUnit())) {
    log.warn("Unit mismatch for {}: {} vs {}", 
        name, existingItem.getUnit(), newItem.getUnit());
}
```

### Q4: Fuzzy Matching ì•Œê³ ë¦¬ì¦˜ì€?
**A:** 3ë‹¨ê³„ ë§¤ì¹­:
1. **ì •í™• ë§¤ì¹­**: `ê³„ë€` == `ê³„ë€`
2. **í¬í•¨ ë§¤ì¹­**: `ìœ ê¸°ë† ê³„ë€` contains `ê³„ë€`
3. **ìœ ì‚¬ë„ ë§¤ì¹­**: Levenshtein Distance ê¸°ë°˜ (70% ì´ìƒ)

```java
private double calculateSimilarity(String s1, String s2) {
    int distance = levenshteinDistance(s1, s2);
    int maxLen = Math.max(s1.length(), s2.length());
    return 1.0 - ((double) distance / maxLen);
}
```

### Q5: ì°¨ê° ë¯¸ë¦¬ë³´ê¸°ì™€ ì‹¤í–‰ì„ ë¶„ë¦¬í•œ ì´ìœ ëŠ”?
**A:**
- **UX**: ì‚¬ìš©ìê°€ ì°¨ê° ê²°ê³¼ë¥¼ í™•ì¸ í›„ ê²°ì •
- **ì˜¤ë¥˜ ë°©ì§€**: ì˜ëª»ëœ ì°¨ê° ì·¨ì†Œ ì–´ë ¤ì›€
- **ë°ì´í„° ì •í•©ì„±**: ë¯¸ë¦¬ë³´ê¸°ëŠ” ReadOnly íŠ¸ëœì­ì…˜

```java
@Transactional(readOnly = true)  // ë¯¸ë¦¬ë³´ê¸°
public DeductionDto previewDeduction(...) { }

@Transactional  // ì‹¤í–‰
public DeductionResultDto executeDeduction(...) { }
```

### Q6: ë ˆì‹œí”¼ ì¶”ì²œ ì„±ëŠ¥ ìµœì í™”ëŠ”?
**A:**
- **í˜„ì¬**: ì „ì²´ ë ˆì‹œí”¼ ìˆœíšŒ O(n)
- **ê°œì„  ë°©ì•ˆ**:
  1. Elasticsearch ë„ì… (ì—­ì¸ë±ìŠ¤)
  2. Redis ìºì‹± (ìì£¼ ê²€ìƒ‰ë˜ëŠ” ì¬ë£Œ)
  3. ì¬ë£Œë³„ ë ˆì‹œí”¼ ì¸ë±ìŠ¤ í…Œì´ë¸”

### Q7: ìœ í†µê¸°í•œ ê°±ì‹  ì •ì±…ì€?
**A:**
```java
// ë” ê¸´ ìœ í†µê¸°í•œìœ¼ë¡œ ê°±ì‹ 
public void updateExpirationDateIfLonger(LocalDate newDate) {
    if (newDate != null) {
        if (this.expirationDate == null || 
            newDate.isAfter(this.expirationDate)) {
            this.expirationDate = newDate;
        }
    }
}
```
- **ì´ìœ **: ê°€ì¥ ìµœê·¼ êµ¬ë§¤ ìƒí’ˆì´ ë” ê¸´ ìœ í†µê¸°í•œ ê°€ì •
- **ë¬¸ì œì **: FIFO ê´€ë¦¬ ë¶ˆê°€ â†’ ê°œì„  í•„ìš”

### Q8: API ì˜¤ë¥˜ ì²˜ë¦¬ëŠ”?
**A:**
| ì˜ˆì™¸ | ìƒí™© | HTTP ì½”ë“œ |
|------|------|-----------|
| `GeminiApiException` | API í‚¤ ì—†ìŒ, í˜¸ì¶œ ì‹¤íŒ¨ | 503 |
| `ReceiptParseException` | JSON íŒŒì‹± ì‹¤íŒ¨ | 422 |
| `ResourceNotFoundException` | ì¬ë£Œ/ë ˆì‹œí”¼ ì—†ìŒ | 404 |
| `IllegalArgumentException` | ìˆ˜ëŸ‰ ë¶€ì¡± | 400 |

### Q9: ì´ë¯¸ì§€ í¬ê¸° ì œí•œì€?
**A:**
```java
// application.yml
spring:
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
```
- **Gemini ì œí•œ**: 20MB/ì´ë¯¸ì§€
- **ê¶Œì¥**: 1-5MB (ì••ì¶•ëœ JPEG)

### Q10: íŠ¸ëœì­ì…˜ ê´€ë¦¬ëŠ”?
**A:**
- **ëª©ë¡ ì¡°íšŒ**: `@Transactional(readOnly = true)` - ì„±ëŠ¥ ìµœì í™”
- **ì¶”ê°€/ìˆ˜ì •**: `@Transactional` - ìë™ ë¡¤ë°±
- **ë³‘í•© ë¡œì§**: ë‹¨ì¼ íŠ¸ëœì­ì…˜ ë‚´ ì²˜ë¦¬ (ì›ìì„± ë³´ì¥)

---

## ğŸ“ ê´€ë ¨ íŒŒì¼ ëª©ë¡

| íŒŒì¼ | ê²½ë¡œ | ìš©ë„ |
|------|------|------|
| RefrigeratorController.java | `.../refrigerator/controller/` | REST API |
| RefrigeratorService.java | `.../refrigerator/service/` | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ |
| GeminiService.java | `.../refrigerator/service/` | Gemini API |
| RefrigeratorItem.java | `.../refrigerator/domain/` | ì—”í‹°í‹° |
| RefrigeratorItemRepository.java | `.../refrigerator/domain/` | Repository |
| IngredientRequest.java | `.../refrigerator/dto/request/` | ìš”ì²­ DTO |
| IngredientResponse.java | `.../refrigerator/dto/response/` | ì‘ë‹µ DTO |
| ReceiptScanResponse.java | `.../refrigerator/dto/response/` | ìŠ¤ìº” ê²°ê³¼ |
| RecommendationDto.java | `.../refrigerator/dto/response/` | ì¶”ì²œ ê²°ê³¼ |
| DeductionDto.java | `.../refrigerator/dto/response/` | ì°¨ê° ë¯¸ë¦¬ë³´ê¸° |
| GeminiConfig.java | `.../refrigerator/config/` | ì„¤ì • |
| GeminiApiException.java | `.../refrigerator/exception/` | ì˜ˆì™¸ |

---

## âš™ï¸ ì„¤ì • í•­ëª©

```yaml
# application.yml
gemini:
  api:
    key: ${GEMINI_API_KEY:}

spring:
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
```

---

## ğŸ”— ì—°ê´€ ëª¨ë“ˆ

| ëª¨ë“ˆ | ì—°ê´€ ê¸°ëŠ¥ |
|------|-----------|
| Recipe | ë ˆì‹œí”¼ ì¶”ì²œ, ì°¨ê° ì‹œ ë ˆì‹œí”¼ ì •ë³´ ì¡°íšŒ |
| Shopping | ëƒ‰ì¥ê³  ì¬ë£Œ ê¸°ë°˜ ìƒí’ˆ ì¶”ì²œ |
| Diary | ë ˆì‹œí”¼ ì¡°ë¦¬ ê¸°ë¡ ì €ì¥ |
