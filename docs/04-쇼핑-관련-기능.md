# ì‡¼í•‘ ê´€ë ¨ ê¸°ëŠ¥ (Issue #86)

> **GitHub Issue**: https://github.com/Capstone-C/BE-FE/issues/86  
> **ë‹´ë‹¹ì**: qoweh  
> **ìƒíƒœ**: Open (1ê°œ ì„œë¸Œì´ìŠˆ ì¤‘ 0ê°œ ì™„ë£Œ)

---

## ğŸ“‹ ëª©ì°¨
1. [ê¸°ëŠ¥ ê°œìš”](#1-ê¸°ëŠ¥-ê°œìš”)
2. [ì„œë¸Œ ì´ìŠˆ ëª©ë¡](#2-ì„œë¸Œ-ì´ìŠˆ-ëª©ë¡)
3. [íŒŒì¼ êµ¬ì¡°](#3-íŒŒì¼-êµ¬ì¡°)
4. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#4-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
5. [API ëª…ì„¸](#5-api-ëª…ì„¸)
6. [í•µì‹¬ êµ¬í˜„ ìƒì„¸](#6-í•µì‹¬-êµ¬í˜„-ìƒì„¸)
7. [ì™¸ë¶€ API ì—°ë™](#7-ì™¸ë¶€-api-ì—°ë™)
8. [ë””ìì¸ íŒ¨í„´](#8-ë””ìì¸-íŒ¨í„´)
9. [ì˜ˆìƒ ì§ˆë¬¸ ë° ë‹µë³€](#9-ì˜ˆìƒ-ì§ˆë¬¸-ë°-ë‹µë³€)

---

## 1. ê¸°ëŠ¥ ê°œìš”

ì‡¼í•‘ ëª¨ë“ˆì€ í†µí•© ì‡¼í•‘ëª° ìƒí’ˆ ê²€ìƒ‰ ë° ëƒ‰ì¥ê³  ê¸°ë°˜ ìƒí’ˆ ì¶”ì²œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥
- **ìƒí’ˆ ê²€ìƒ‰**: í‚¤ì›Œë“œ ê¸°ë°˜ í†µí•© ì‡¼í•‘ëª° ê²€ìƒ‰
- **í•„í„°ë§**: ì¹´í…Œê³ ë¦¬, ê°€ê²© ë²”ìœ„ í•„í„°
- **ì •ë ¬**: ì •í™•ë„, ê°€ê²©ìˆœ ì •ë ¬
- **ìƒí’ˆ ì¶”ì²œ**: ëƒ‰ì¥ê³  ì¬ë£Œ ê¸°ë°˜ êµ¬ë§¤ ì¶”ì²œ (ìˆ˜ëŸ‰ ë¶€ì¡±, ìœ í†µê¸°í•œ ì„ë°•)

### ê¸°ìˆ ì  íŠ¹ì§•
- **Strategy Pattern**: ì‡¼í•‘ëª° API í™•ì¥ ìš©ì´
- **ì™¸ë¶€ API ì—°ë™**: Naver Shopping API
- **í˜ì´ì§• ì²˜ë¦¬**: í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í˜ì´ì§•

---

## 2. ì„œë¸Œ ì´ìŠˆ ëª©ë¡

| ì´ìŠˆ | ì œëª© | ìƒíƒœ |
|------|------|------|
| #87 | SHOP-01: í†µí•© ì‡¼í•‘ëª° ìƒí’ˆ ê²€ìƒ‰ | ğŸ”„ ì§„í–‰ì¤‘ |

---

## 3. íŒŒì¼ êµ¬ì¡°

```
/CC_BE/src/main/java/com/capstone/web/shopping/
â”œâ”€â”€ client/                                    # ì™¸ë¶€ API í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ ShoppingMallApiClient.java             # ì¸í„°í˜ì´ìŠ¤ (Strategy)
â”‚   â””â”€â”€ NaverShoppingApiClient.java            # ë„¤ì´ë²„ API êµ¬í˜„ì²´
â”œâ”€â”€ config/
â”‚   â””â”€â”€ ShoppingConfig.java                    # ì„¤ì •
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ ProductSearchController.java           # REST API
â”œâ”€â”€ domain/                                    # ë„ë©”ì¸ ëª¨ë¸
â”‚   â”œâ”€â”€ ProductCategory.java                   # ì¹´í…Œê³ ë¦¬ Enum
â”‚   â”œâ”€â”€ ProductDocument.java                   # ìƒí’ˆ ë°ì´í„° ëª¨ë¸
â”‚   â””â”€â”€ ShoppingMallType.java                  # ì‡¼í•‘ëª° íƒ€ì… Enum
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ NaverShoppingResponse.java             # ë„¤ì´ë²„ API ì‘ë‹µ DTO
â”‚   â”œâ”€â”€ ProductSearchRequest.java              # ê²€ìƒ‰ ìš”ì²­ DTO
â”‚   â””â”€â”€ ProductSearchResponse.java             # ê²€ìƒ‰ ì‘ë‹µ DTO
â””â”€â”€ service/
    â”œâ”€â”€ ProductSearchService.java              # ìƒí’ˆ ê²€ìƒ‰ ì„œë¹„ìŠ¤
    â””â”€â”€ ProductRecommendationService.java      # ìƒí’ˆ ì¶”ì²œ ì„œë¹„ìŠ¤
```

---

## 4. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 4.1 ì „ì²´ íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚â”€â”€â”€â”€â–ºâ”‚  ProductSearch   â”‚â”€â”€â”€â”€â–ºâ”‚ ProductSearch     â”‚
â”‚   (React)    â”‚     â”‚  Controller      â”‚     â”‚ Service           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    ShoppingMallApiClient           â”‚
                              â”‚    (Strategy Interface)            â”‚
                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                              â”‚  â”‚ NaverShoppingApiClient      â”‚   â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â”‚                 â”‚                  â”‚
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                              â”‚  â”‚ CoupangApiClient (í™•ì¥ ê°€ëŠ¥) â”‚   â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚     Naver Shopping API             â”‚
                              â”‚  openapi.naver.com/v1/search/shop  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ìƒí’ˆ ì¶”ì²œ íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ì‚¬ìš©ì ìš”ì²­    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ProductRecommendationService          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ëƒ‰ì¥ê³  ì¬ë£Œ ì¡°íšŒ (RefrigeratorRepository) â”‚
â”‚ 2. êµ¬ë§¤ í•„ìš” ì¬ë£Œ í•„í„°ë§                      â”‚
â”‚    - ìˆ˜ëŸ‰ <= 2 (lowQuantityThreshold)        â”‚
â”‚    - ìœ í†µê¸°í•œ D-3 ì´ë‚´ (expirationThreshold) â”‚
â”‚ 3. ê° ì¬ë£Œë¡œ ë„¤ì´ë²„ ì‡¼í•‘ ê²€ìƒ‰                 â”‚
â”‚ 4. ì¶”ì²œ ê²°ê³¼ ë°˜í™˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. API ëª…ì„¸

### 5.1 ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| GET | `/api/v1/shopping/search` | ìƒí’ˆ ê²€ìƒ‰ | âŒ ë¶ˆí•„ìš” |

### 5.2 ìš”ì²­ íŒŒë¼ë¯¸í„°

```http
GET /api/v1/shopping/search?keyword=ìœ ê¸°ë†ê³„ë€&minPrice=5000&maxPrice=30000&sortBy=price_asc&page=0&size=20
```

| íŒŒë¼ë¯¸í„° | íƒ€ì… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|----------|------|------|--------|------|
| `keyword` | String | âœ… | - | ê²€ìƒ‰ í‚¤ì›Œë“œ |
| `mallType` | String | âŒ | - | ì‡¼í•‘ëª° í•„í„° (NAVER) |
| `category` | String | âŒ | - | ì¹´í…Œê³ ë¦¬ í•„í„° |
| `minPrice` | Integer | âŒ | - | ìµœì†Œ ê°€ê²© |
| `maxPrice` | Integer | âŒ | - | ìµœëŒ€ ê°€ê²© |
| `sortBy` | String | âŒ | `relevance` | ì •ë ¬ ê¸°ì¤€ |
| `page` | Integer | âŒ | 0 | í˜ì´ì§€ ë²ˆí˜¸ |
| `size` | Integer | âŒ | 20 | í˜ì´ì§€ í¬ê¸° |

### 5.3 ì •ë ¬ ì˜µì…˜

| sortBy | ì„¤ëª… |
|--------|------|
| `relevance` / `score` | ì •í™•ë„ìˆœ (ê¸°ë³¸ê°’) |
| `price_asc` | ê°€ê²© ë‚®ì€ìˆœ |
| `price_desc` | ê°€ê²© ë†’ì€ìˆœ |
| `name` | ìƒí’ˆëª…ìˆœ |

### 5.4 ì‘ë‹µ ì˜ˆì‹œ

```json
{
  "products": [
    {
      "id": "NAVER_12345",
      "name": "ìœ ê¸°ë† ê³„ë€ 30êµ¬",
      "price": 12000,
      "originalPrice": 15000,
      "discountRate": 20,
      "imageUrl": "https://shopping-phinf.../12345.jpg",
      "productUrl": "https://search.shopping.naver.com/...",
      "mallType": "NAVER",
      "category": "DAIRY",
      "rating": 4.5,
      "reviewCount": 128,
      "deliveryInfo": "ë§ˆì¼“ì»¬ë¦¬ ë°°ì†¡"
    }
  ],
  "totalCount": 178,
  "currentPage": 0,
  "totalPages": 9,
  "pageSize": 20
}
```

---

## 6. í•µì‹¬ êµ¬í˜„ ìƒì„¸

### 6.1 ShoppingMallApiClient ì¸í„°í˜ì´ìŠ¤ (Strategy Pattern)

```java
public interface ShoppingMallApiClient {
    
    /**
     * í‚¤ì›Œë“œë¡œ ìƒí’ˆ ê²€ìƒ‰
     * @param keyword ê²€ìƒ‰ì–´
     * @param maxResults ìµœëŒ€ ê²°ê³¼ ìˆ˜
     * @return ìƒí’ˆ ëª©ë¡
     */
    List<ProductDocument> searchProducts(String keyword, int maxResults);
    
    /**
     * ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ì¡°íšŒ
     */
    List<ProductDocument> getProductsByCategory(String category, int maxResults);
    
    /**
     * ì‡¼í•‘ëª° íƒ€ì… ë°˜í™˜
     */
    String getMallType();
    
    /**
     * API ì—°ê²° ìƒíƒœ í™•ì¸
     */
    boolean isHealthy();
}
```

### 6.2 NaverShoppingApiClient êµ¬í˜„ì²´

```java
@Component
@Slf4j
public class NaverShoppingApiClient implements ShoppingMallApiClient {
    
    private static final String API_URL = 
        "https://openapi.naver.com/v1/search/shop.json";
    
    private final RestTemplate restTemplate;
    private final String clientId;
    private final String clientSecret;
    
    public NaverShoppingApiClient(
            RestTemplate restTemplate,
            @Value("${naver.api.client-id:}") String clientId,
            @Value("${naver.api.client-secret:}") String clientSecret) {
        this.restTemplate = restTemplate;
        this.clientId = clientId;
        this.clientSecret = clientSecret;
    }
    
    @Override
    public List<ProductDocument> searchProducts(String keyword, int maxResults) {
        if (!isConfigured()) {
            log.warn("Naver API credentials not configured");
            return Collections.emptyList();
        }
        
        // URL êµ¬ì„±
        String url = UriComponentsBuilder.fromUriString(API_URL)
                .queryParam("query", keyword)
                .queryParam("display", Math.min(maxResults, 100))
                .queryParam("start", 1)
                .queryParam("sort", "sim")  // ì •í™•ë„ìˆœ
                .build()
                .toUriString();
        
        // ì¸ì¦ í—¤ë” ì„¤ì •
        HttpHeaders headers = new HttpHeaders();
        headers.set("X-Naver-Client-Id", clientId);
        headers.set("X-Naver-Client-Secret", clientSecret);
        headers.setContentType(MediaType.APPLICATION_JSON);
        
        // API í˜¸ì¶œ
        HttpEntity<String> entity = new HttpEntity<>(headers);
        ResponseEntity<NaverShoppingResponse> response = 
            restTemplate.exchange(url, HttpMethod.GET, entity, 
                NaverShoppingResponse.class);
        
        // ì‘ë‹µ ë³€í™˜
        return convertToProductDocuments(response.getBody());
    }
    
    private List<ProductDocument> convertToProductDocuments(
            NaverShoppingResponse response) {
        if (response == null || response.getItems() == null) {
            return Collections.emptyList();
        }
        
        return response.getItems().stream()
            .map(this::convertItem)
            .collect(Collectors.toList());
    }
    
    private ProductDocument convertItem(NaverShoppingResponse.NaverProduct item) {
        // HTML íƒœê·¸ ì œê±°
        String cleanTitle = item.getTitle()
            .replaceAll("<[^>]*>", "")  // <b>, </b> ë“± ì œê±°
            .trim();
        
        // ê°€ê²© íŒŒì‹±
        int price = parsePrice(item.getLprice());
        int originalPrice = parsePrice(item.getHprice());
        
        // ì¹´í…Œê³ ë¦¬ ë§¤í•‘
        String category = mapNaverCategoryToOurCategory(
            item.getCategory1(), item.getCategory2(), item.getCategory3());
        
        String documentId = ProductDocument.generateId(
            ShoppingMallType.NAVER.name(), item.getProductId());
        
        return ProductDocument.builder()
                .id(documentId)
                .name(cleanTitle)
                .price(price)
                .originalPrice(originalPrice > 0 ? originalPrice : null)
                .imageUrl(item.getImage())
                .productUrl(item.getLink())
                .mallType(ShoppingMallType.NAVER.name())
                .category(category)
                .externalProductId(item.getProductId())
                .build();
    }
}
```

### 6.3 ProductSearchService

```java
@Service
@RequiredArgsConstructor
public class ProductSearchService {
    
    private final NaverShoppingApiClient naverShoppingApiClient;
    
    public Page<ProductDocument> searchProducts(ProductSearchRequest request) {
        String keyword = request.getKeyword();
        if (keyword == null || keyword.isBlank()) {
            return Page.empty();
        }
        
        // 1. ë„¤ì´ë²„ API í˜¸ì¶œ (ìµœëŒ€ 100ê°œ)
        List<ProductDocument> allProducts = 
            naverShoppingApiClient.searchProducts(keyword.trim(), 100);
        
        // 2. í•„í„°ë§ ì ìš©
        List<ProductDocument> filteredProducts = applyFilters(allProducts, request);
        
        // 3. ì •ë ¬ ì ìš©
        String sortBy = request.getSortBy() != null ? request.getSortBy() : "relevance";
        List<ProductDocument> sortedProducts = applySorting(filteredProducts, sortBy);
        
        // 4. í˜ì´ì§• ì ìš©
        int page = request.getPage() != null ? request.getPage() : 0;
        int size = request.getSize() != null ? request.getSize() : 20;
        
        int start = page * size;
        int end = Math.min(start + size, sortedProducts.size());
        
        if (start >= sortedProducts.size()) {
            return Page.empty(PageRequest.of(page, size));
        }
        
        List<ProductDocument> pagedProducts = sortedProducts.subList(start, end);
        return new PageImpl<>(pagedProducts, PageRequest.of(page, size), 
            sortedProducts.size());
    }
    
    private List<ProductDocument> applyFilters(
            List<ProductDocument> products, ProductSearchRequest request) {
        
        return products.stream()
            .filter(p -> {
                // ì¹´í…Œê³ ë¦¬ í•„í„°
                if (request.getCategory() != null && !request.getCategory().isBlank()) {
                    if (!request.getCategory().equals(p.getCategory())) {
                        return false;
                    }
                }
                // ìµœì†Œ ê°€ê²© í•„í„°
                if (request.getMinPrice() != null && p.getPrice() != null) {
                    if (p.getPrice() < request.getMinPrice()) {
                        return false;
                    }
                }
                // ìµœëŒ€ ê°€ê²© í•„í„°
                if (request.getMaxPrice() != null && p.getPrice() != null) {
                    if (p.getPrice() > request.getMaxPrice()) {
                        return false;
                    }
                }
                return true;
            })
            .collect(Collectors.toList());
    }
    
    private List<ProductDocument> applySorting(
            List<ProductDocument> products, String sortBy) {
        
        List<ProductDocument> sorted = new ArrayList<>(products);
        
        switch (sortBy.toLowerCase()) {
            case "price_asc":
                sorted.sort(Comparator.comparing(
                    ProductDocument::getPrice, 
                    Comparator.nullsLast(Comparator.naturalOrder())));
                break;
            case "price_desc":
                sorted.sort(Comparator.comparing(
                    ProductDocument::getPrice, 
                    Comparator.nullsLast(Comparator.reverseOrder())));
                break;
            case "name":
                sorted.sort(Comparator.comparing(
                    ProductDocument::getName, 
                    Comparator.nullsLast(Comparator.naturalOrder())));
                break;
            // relevance, scoreëŠ” API ê¸°ë³¸ ì •ë ¬ ìœ ì§€
        }
        
        return sorted;
    }
}
```

### 6.4 ProductRecommendationService

```java
@Service
@RequiredArgsConstructor
public class ProductRecommendationService {
    
    private final RefrigeratorItemRepository refrigeratorItemRepository;
    private final NaverShoppingApiClient naverShoppingApiClient;
    
    @Value("${shopping.recommendation.low-quantity-threshold:2}")
    private int lowQuantityThreshold;
    
    @Value("${shopping.recommendation.expiration-days-threshold:3}")
    private int expirationDaysThreshold;
    
    @Value("${shopping.recommendation.max-products-per-item:10}")
    private int maxProductsPerItem;
    
    public List<RecommendationResult> recommendProductsForMember(Long memberId) {
        // 1. êµ¬ë§¤ í•„ìš”í•œ ì¬ë£Œ ì°¾ê¸°
        List<RefrigeratorItem> needPurchase = findItemsNeedingPurchase(memberId);
        
        List<RecommendationResult> results = new ArrayList<>();
        
        // 2. ê° ì¬ë£Œì— ëŒ€í•´ ìƒí’ˆ ê²€ìƒ‰
        for (RefrigeratorItem item : needPurchase) {
            String reason = determineReason(item);
            
            List<ProductDocument> products = 
                naverShoppingApiClient.searchProducts(item.getName(), maxProductsPerItem);
            
            results.add(RecommendationResult.builder()
                    .ingredientName(item.getName())
                    .reason(reason)
                    .currentQuantity(item.getQuantity())
                    .expirationDate(item.getExpirationDate())
                    .products(products)
                    .build());
        }
        
        return results;
    }
    
    private List<RefrigeratorItem> findItemsNeedingPurchase(Long memberId) {
        return refrigeratorItemRepository.findByMemberId(memberId).stream()
            .filter(item -> 
                item.getQuantity() <= lowQuantityThreshold ||
                isExpiringSoon(item))
            .collect(Collectors.toList());
    }
    
    private boolean isExpiringSoon(RefrigeratorItem item) {
        if (item.getExpirationDate() == null) return false;
        
        long daysUntilExpiration = ChronoUnit.DAYS.between(
            LocalDate.now(), item.getExpirationDate());
        return daysUntilExpiration >= 0 && 
               daysUntilExpiration <= expirationDaysThreshold;
    }
    
    private String determineReason(RefrigeratorItem item) {
        if (item.getQuantity() <= lowQuantityThreshold) {
            return "ìˆ˜ëŸ‰ ë¶€ì¡±";
        }
        if (isExpiringSoon(item)) {
            return "ìœ í†µê¸°í•œ ì„ë°•";
        }
        return "ê¸°íƒ€";
    }
    
    @Builder
    @Getter
    public static class RecommendationResult {
        private String ingredientName;
        private String reason;
        private Integer currentQuantity;
        private LocalDate expirationDate;
        private List<ProductDocument> products;
    }
}
```

---

## 7. ì™¸ë¶€ API ì—°ë™

### 7.1 Naver Shopping API

#### API ì •ë³´
| í•­ëª© | ê°’ |
|------|-----|
| **URL** | `https://openapi.naver.com/v1/search/shop.json` |
| **ì¸ì¦** | í—¤ë” (X-Naver-Client-Id, X-Naver-Client-Secret) |
| **ìµœëŒ€ ê²°ê³¼** | 100ê°œ/ìš”ì²­ |
| **ì¼ì¼ ì¿¼í„°** | 25,000ê±´/ì¼ |

#### ìš”ì²­ íŒŒë¼ë¯¸í„°
| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ì˜ˆì‹œ |
|----------|------|------|
| `query` | ê²€ìƒ‰ì–´ | ìœ ê¸°ë† ê³„ë€ |
| `display` | ê²°ê³¼ ê°œìˆ˜ (1-100) | 100 |
| `start` | ì‹œì‘ ìœ„ì¹˜ | 1 |
| `sort` | ì •ë ¬ (sim, date, asc, dsc) | sim |

#### ì‘ë‹µ ì˜ˆì‹œ
```json
{
  "lastBuildDate": "Fri, 06 Dec 2024 10:00:00 +0900",
  "total": 1234,
  "start": 1,
  "display": 10,
  "items": [
    {
      "title": "<b>ìœ ê¸°ë†</b> <b>ê³„ë€</b> 30êµ¬",
      "link": "https://search.shopping.naver.com/...",
      "image": "https://shopping-phinf.../12345.jpg",
      "lprice": "12000",
      "hprice": "15000",
      "mallName": "ë§ˆì¼“ì»¬ë¦¬",
      "productId": "12345678",
      "brand": "í’€ë¬´ì›",
      "maker": "í’€ë¬´ì›",
      "category1": "ì‹í’ˆ",
      "category2": "ìœ ì œí’ˆ",
      "category3": "ê³„ë€",
      "category4": ""
    }
  ]
}
```

### 7.2 í™˜ê²½ë³€ìˆ˜ ì„¤ì •

```yaml
# application.yml
naver:
  api:
    client-id: ${NAVER_CLIENT_ID:}
    client-secret: ${NAVER_CLIENT_SECRET:}
```

```bash
# .env
NAVER_CLIENT_ID=your_client_id
NAVER_CLIENT_SECRET=your_client_secret
```

### 7.3 ì¹´í…Œê³ ë¦¬ ë§¤í•‘

```java
private String mapNaverCategoryToOurCategory(
        String cat1, String cat2, String cat3) {
    
    if ("ì‹í’ˆ".equals(cat1)) {
        if (cat2 != null) {
            if (cat2.contains("ì±„ì†Œ")) return ProductCategory.VEGETABLES.name();
            if (cat2.contains("ê³¼ì¼")) return ProductCategory.FRUITS.name();
            if (cat2.contains("ì •ìœ¡") || cat2.contains("ê³ ê¸°")) 
                return ProductCategory.MEAT.name();
            if (cat2.contains("ìˆ˜ì‚°")) return ProductCategory.SEAFOOD.name();
            if (cat2.contains("ìœ ì œí’ˆ")) return ProductCategory.DAIRY.name();
            if (cat2.contains("ê³¡ë¬¼") || cat2.contains("ìŒ€")) 
                return ProductCategory.GRAINS.name();
            if (cat2.contains("ê³¼ì") || cat2.contains("ê°„ì‹")) 
                return ProductCategory.SNACKS.name();
            if (cat2.contains("ìŒë£Œ")) return ProductCategory.BEVERAGES.name();
            if (cat2.contains("ì¡°ë¯¸ë£Œ") || cat2.contains("ì–‘ë…")) 
                return ProductCategory.SEASONINGS.name();
        }
        return ProductCategory.PROCESSED.name();
    }
    return ProductCategory.ETC.name();
}
```

---

## 8. ë””ìì¸ íŒ¨í„´

### 8.1 Strategy Pattern
- **ì ìš©**: `ShoppingMallApiClient` ì¸í„°í˜ì´ìŠ¤
- **êµ¬í˜„ì²´**: `NaverShoppingApiClient`
- **í™•ì¥ ê°€ëŠ¥**: `CoupangApiClient`, `GmarketApiClient` ë“±

### 8.2 Builder Pattern
- **ì ìš©**: `ProductDocument`, `RecommendationResult`
- **ì¥ì **: ë³µì¡í•œ ê°ì²´ ìƒì„± ê°„ì†Œí™”

### 8.3 DTO Pattern
- **ì ìš©**: `ProductSearchRequest`, `ProductSearchResponse`
- **ì¥ì **: API ê³„ì•½ê³¼ ë„ë©”ì¸ ë¶„ë¦¬

### 8.4 Facade Pattern
- **ì ìš©**: `ProductSearchService`
- **ì—­í• **: ì™¸ë¶€ API í˜¸ì¶œ + í•„í„°ë§ + ì •ë ¬ + í˜ì´ì§•ì„ í•˜ë‚˜ë¡œ í†µí•©

---

## 9. ì˜ˆìƒ ì§ˆë¬¸ ë° ë‹µë³€

### Q1: ì™œ Strategy Patternì„ ì‚¬ìš©í–ˆë‚˜ìš”?
**A:**
- **í™•ì¥ì„±**: ìƒˆ ì‡¼í•‘ëª° API ì¶”ê°€ ì‹œ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ë§Œ í•˜ë©´ ë¨
- **êµì²´ ìš©ì´**: ëŸ°íƒ€ì„ì— ë‹¤ë¥¸ êµ¬í˜„ì²´ë¡œ êµì²´ ê°€ëŠ¥
- **í…ŒìŠ¤íŠ¸ ìš©ì´**: Mock ê°ì²´ë¡œ ëŒ€ì²´ ê°€ëŠ¥
- **SOLID ì›ì¹™**: OCP(ê°œë°©-íì‡„ ì›ì¹™) ì¤€ìˆ˜

### Q2: ë„¤ì´ë²„ API ì™¸ì— ë‹¤ë¥¸ ì‡¼í•‘ëª° í™•ì¥ì€?
**A:**
```java
// ì¿ íŒ¡ í™•ì¥ ì˜ˆì‹œ
@Component
public class CoupangApiClient implements ShoppingMallApiClient {
    @Override
    public List<ProductDocument> searchProducts(String keyword, int maxResults) {
        // Coupang Partners API í˜¸ì¶œ
    }
    
    @Override
    public String getMallType() {
        return ShoppingMallType.COUPANG.name();
    }
}
```

### Q3: í˜ì´ì§•ì´ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì¸ ì´ìœ ëŠ”?
**A:**
- **ë„¤ì´ë²„ API í•œê³„**: start íŒŒë¼ë¯¸í„°ë¡œ 100ê°œê¹Œì§€ë§Œ ì¡°íšŒ
- **í•„í„°ë§/ì •ë ¬**: ì„œë²„ì—ì„œ ì¶”ê°€ ì²˜ë¦¬ í•„ìš”
- **ê°œì„  ë°©í–¥**: Elasticsearch ë„ì… ì‹œ ì„œë²„ ì‚¬ì´ë“œ í˜ì´ì§•

### Q4: ìƒí’ˆ ì¶”ì²œ ê¸°ì¤€ì€?
**A:**
| ê¸°ì¤€ | ì„ê³„ê°’ | ì„¤ì • |
|------|--------|------|
| ìˆ˜ëŸ‰ ë¶€ì¡± | â‰¤ 2ê°œ | `low-quantity-threshold` |
| ìœ í†µê¸°í•œ ì„ë°• | D-3 ì´ë‚´ | `expiration-days-threshold` |

### Q5: API ì¿¼í„° ê´€ë¦¬ëŠ”?
**A:**
- **í˜„ì¬**: ì¼ì¼ 25,000ê±´ (ë„¤ì´ë²„ ë¬´ë£Œ)
- **ëª¨ë‹ˆí„°ë§**: ë¡œê¹…ìœ¼ë¡œ í˜¸ì¶œ íšŸìˆ˜ ì¶”ì 
- **ê°œì„  ë°©í–¥**: Redis ìºì‹±ìœ¼ë¡œ ì¤‘ë³µ ìš”ì²­ ê°ì†Œ

### Q6: í• ì¸ìœ¨ì€ ì–´ë–»ê²Œ ê³„ì‚°í•˜ë‚˜ìš”?
**A:**
```java
public Integer getDiscountRate() {
    if (originalPrice == null || originalPrice <= 0 || price >= originalPrice) {
        return 0;
    }
    return (int) Math.round(
        (double) (originalPrice - price) / originalPrice * 100
    );
}
```

### Q7: ì¸ì¦ ì—†ì´ ê²€ìƒ‰ APIë¥¼ ê³µê°œí•œ ì´ìœ ëŠ”?
**A:**
- ìƒí’ˆ ê²€ìƒ‰ì€ **ë¡œê·¸ì¸ ì „ íƒìƒ‰ ê¸°ëŠ¥**
- SEO ë° ì‚¬ìš©ì ê²½í—˜ ê³ ë ¤
- ì¶”ì²œ ê¸°ëŠ¥ì€ **ëƒ‰ì¥ê³  ë°ì´í„° í•„ìš”**í•˜ë¯€ë¡œ ì¸ì¦ í•„ìš”

### Q8: HTML íƒœê·¸ ì œê±°ëŠ” ì™œ í•„ìš”í•œê°€ìš”?
**A:**
- ë„¤ì´ë²„ API ì‘ë‹µì— `<b>ìœ ê¸°ë†</b>` í˜•íƒœë¡œ í•˜ì´ë¼ì´íŠ¸ í¬í•¨
- í´ë¼ì´ì–¸íŠ¸ í‘œì‹œ ì‹œ ë¶ˆí•„ìš”í•œ íƒœê·¸
- `replaceAll("<[^>]*>", "")` ì •ê·œì‹ìœ¼ë¡œ ì œê±°

---

## ğŸ“ ê´€ë ¨ íŒŒì¼ ëª©ë¡

| íŒŒì¼ | ê²½ë¡œ | ìš©ë„ |
|------|------|------|
| ShoppingMallApiClient.java | `.../shopping/client/` | ì¸í„°í˜ì´ìŠ¤ |
| NaverShoppingApiClient.java | `.../shopping/client/` | ë„¤ì´ë²„ êµ¬í˜„ì²´ |
| ProductSearchController.java | `.../shopping/controller/` | REST API |
| ProductSearchService.java | `.../shopping/service/` | ê²€ìƒ‰ ì„œë¹„ìŠ¤ |
| ProductRecommendationService.java | `.../shopping/service/` | ì¶”ì²œ ì„œë¹„ìŠ¤ |
| ProductDocument.java | `.../shopping/domain/` | ìƒí’ˆ ëª¨ë¸ |
| ProductCategory.java | `.../shopping/domain/` | ì¹´í…Œê³ ë¦¬ Enum |
| ShoppingMallType.java | `.../shopping/domain/` | ì‡¼í•‘ëª° Enum |
| ProductSearchRequest.java | `.../shopping/dto/` | ìš”ì²­ DTO |
| ProductSearchResponse.java | `.../shopping/dto/` | ì‘ë‹µ DTO |
| NaverShoppingResponse.java | `.../shopping/dto/` | API ì‘ë‹µ DTO |

---

## âš™ï¸ ì„¤ì • í•­ëª©

```yaml
# application.yml
naver:
  api:
    client-id: ${NAVER_CLIENT_ID:}
    client-secret: ${NAVER_CLIENT_SECRET:}

shopping:
  recommendation:
    low-quantity-threshold: ${SHOPPING_LOW_QUANTITY_THRESHOLD:2}
    expiration-days-threshold: ${SHOPPING_EXPIRATION_DAYS_THRESHOLD:3}
    max-products-per-item: ${SHOPPING_MAX_PRODUCTS_PER_ITEM:10}
```
